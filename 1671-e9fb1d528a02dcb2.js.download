"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1671],{14441:function(e,a,t){var l=t(85893),s=t(67294),i=t(66261),n=t(3732),r=(0,s.forwardRef)((function(e,a){var t=e.value,s=e.label,r=e.onClick,o=e.disabled,d=e.hint,u=e.className,c=e.labelClass,m=e.style,f=e.onClear;return(0,l.jsxs)("button",{className:(0,n.AK)("date-input light flex-1 w-full group",u),onClick:r,ref:a,disabled:o,style:m,children:[(0,l.jsx)(i.Z,{icon:"CalendarIcon",className:"h-4 w-4 mr-2"}),s&&(0,l.jsx)("span",{className:(0,n.AK)("text-gray-400",c),children:s}),t||(0,l.jsx)("span",{className:(0,n.AK)("text-gray-400",c),children:d}),"function"===typeof f&&t&&(0,l.jsx)("div",{className:"absolute opacity-0 group-hover:opacity-100 transition-opacity right-2 hover:text-indigo-500",onClick:function(e){e.stopPropagation(),f()},children:(0,l.jsx)(i.Z,{icon:"XCircleIcon",className:"h-5 w-5"})})]})}));r.displayName="DateInput",a.Z=r},11671:function(e,a,t){t.d(a,{y:function(){return L}});var l=t(85893),s=t(67294),i=t(11355),n=t(69737),r=t(43751),o=t(30120),d=t(9198),u=t.n(d),c=t(57333),m=t(33299),f=t(78680),v=t(3732),x=t(51121),p=t(80360),h=t(14441),y=(t(39828),t(4519)),g=t(33253),N=t(52077),b=t(60728),j=t(14924),F=t(26042),S=t(69396),w=t(29815),E={data:{cleanCustomer:{_id:"",firstName:"",lastName:"",email:"",phone:"",company:"",isSample:!1,address:{line1:"",line2:"",city:"",state:"",postalCode:"",country:""}},customer:{_id:"",firstName:"",lastName:"",email:"",phone:"",company:"",isSample:!1,address:{line1:"",line2:"",city:"",state:"",postalCode:"",country:""},customFields:[]},customFields:[],customFieldsMap:{}},ui:{isDirty:!1,isValid:!0}};function C(e,a){var t,l=function(t){var l,i=e[t],n=(null===(l=a.customFields.find((function(e){return e.Field===i._id})))||void 0===l?void 0:l.value)||"";if(!n)switch(i.type){case"text":n="";break;case"rating":case"dropdown":n=0;break;case"money":case"number":case"date":n=null;break;case"checkbox":n=[]}s[i._id]=n};if(0===e.length||!(null===a||void 0===a?void 0:a.customFields)||0===(null===a||void 0===a||null===(t=a.customFields)||void 0===t?void 0:t.length))return{};for(var s={},i=0;i<e.length;i++)l(i);return s}function Z(e){return!!e.firstName&&/[a-z]/gi.test(e.firstName)&&!!e.email&&(0,v.oH)(e.email)}function _(e,a){return JSON.stringify(e)!==JSON.stringify(a)}function T(e,a){var t=a.data,l=a.type;switch(l){case"SET_FIELD":var s=(0,S.Z)((0,F.Z)({},e.data.customer),(0,j.Z)({},t.field,t.value));return(0,S.Z)((0,F.Z)({},e),{data:(0,S.Z)((0,F.Z)({},e.data),{customer:s}),ui:(0,S.Z)((0,F.Z)({},e.ui),{isDirty:_(s,e.data.cleanCustomer),isValid:Z(s)})});case"SET_ADDRESS_FIELD":var i=(0,S.Z)((0,F.Z)({},e.data.customer),{address:(0,S.Z)((0,F.Z)({},e.data.customer.address),(0,j.Z)({},t.field,t.value))});return(0,S.Z)((0,F.Z)({},e),{data:(0,S.Z)((0,F.Z)({},e.data),{customer:i}),ui:(0,S.Z)((0,F.Z)({},e.ui),{isDirty:_(i,e.data.cleanCustomer),isValid:Z(i)})});case"SET_CUSTOM_FIELDS":var n=Array.isArray(t)?(0,w.Z)(t):[];return(0,S.Z)((0,F.Z)({},e),{data:(0,S.Z)((0,F.Z)({},e.data),{customFields:n,customFieldsMap:C(n,e.data.customer)})});case"SET_CUSTOMER":return(0,S.Z)((0,F.Z)({},e),{data:(0,S.Z)((0,F.Z)({},e.data),{customer:(0,F.Z)({},e.data.customer,t),customFieldsMap:C(e.data.customFields,t)})});case"SET_CUSTOM_FIELD":var r=e.data.customer,o=t.customField._id,d=t.value,u=t.fieldType,c=(0,w.Z)(r.customFields),m=r.customFields.find((function(e){return e.Field===o}));if("checkbox"===u){var f=function(e,a){var t=a.customField,l=a.value,s=a.checked;if(!e)return{Field:t._id,value:s?[l]:[]};if(s)return e.value.includes(l)||e.value.push(l),e;var i=e.value.indexOf(l);return-1!==i&&e.value.splice(i,1),e}(m,t);m||c.push(f)}else m?m.value=d:c.push({Field:o,value:d});var v=(0,S.Z)((0,F.Z)({},r),{customFields:c});return(0,S.Z)((0,F.Z)({},e),{data:(0,S.Z)((0,F.Z)({},e.data),{customer:v,customFieldsMap:C(e.data.customFields,v)}),ui:(0,S.Z)((0,F.Z)({},e.ui),{isDirty:_(r,e.data.cleanCustomer),isValid:Z(r)})});case"RESET_STATE":return(null===t||void 0===t?void 0:t.customer)?D(E,t.customer,t.customFields):(0,F.Z)({},E);default:throw new Error("Action type ".concat(l," not found in manageContactReducer"))}}function D(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0,s=Array.isArray(l)?(0,w.Z)(l):[],i=l?C(l,t):[];return(0,S.Z)((0,F.Z)({},a),{data:(0,S.Z)((0,F.Z)({},a.data),{cleanCustomer:(0,F.Z)({},t),customer:(0,S.Z)((0,F.Z)({},a.data.customer,t),{customFields:(null===t||void 0===t||null===(e=t.customFields)||void 0===e?void 0:e.length)>0?t.customFields:[]}),customFields:s,customFieldsMap:i})})}var k=t(93281);function A(e){var a=e.title,t=e.onClick,s=e.className;return a&&t?(0,l.jsx)("div",{className:(0,v.AK)("self-stretch text-sm font-medium leading-none cursor-pointer py-1",s),onClick:t,children:a}):null}var I=t(94874);function L(e){var a,t,d,j,F,S,w,C,Z=e.customer,_=e.customFields,L=e.hideFeedback,M=void 0!==L&&L,O=e.loading,R=e.onDismiss,U=e.open,V=e.save,z=e.setCustomer,K=e.setOpen,q=e.onManageCustomFields,H=e.manageCustomFieldsOpen,J=void 0!==H&&H,P=function(){z&&z(X.data.cleanCustomer),R&&R(X.data.cleanCustomer),B({type:"RESET_STATE"}),K(!1)},Y=function(){J||(X.ui.isDirty?le("Discard changes?","Are you sure you want to close without saving? Any unsaved changes will be discarded.",(function(){return P()})):(K(!1),setTimeout((function(){return z&&z(X.data.cleanCustomer)}),500)))},W=function(e){return e&&0!==e.length?e.map((function(e,a){var t=X.data.customFieldsMap[e._id];switch(e.type){case"number":return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("label",{className:"mb-1",children:e.name}),(0,l.jsx)(c.Z,{value:t||"",onChange:function(a){return B({type:"SET_CUSTOM_FIELD",data:{customField:e,value:a.target.value}})},thousandSeparator:!1,allowNegative:!0,decimalScale:0,placeholder:"0",allowLeadingZeros:!1,allowEmptyFormatting:!1,className:"input w-full"})]},a);case"money":return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("label",{className:"mb-1",children:e.name}),(0,l.jsx)(c.Z,{value:t||"",onChange:function(a){return B({type:"SET_CUSTOM_FIELD",data:{customField:e,value:a.target.value}})},thousandSeparator:",",decimalSeparator:".",allowNegative:!0,decimalScale:2,prefix:"$",placeholder:"$0",allowLeadingZeros:!1,allowEmptyFormatting:!1,className:"input w-full"})]},a);case"date":return(0,l.jsxs)("div",{className:"flex flex-col md:min-w-40 w-full",children:[(0,l.jsx)("label",{className:"mb-1",children:e.name}),(0,l.jsx)(u(),{className:"w-full flex-1",selected:t?new Date(t):null,onChange:function(a){return B({type:"SET_CUSTOM_FIELD",data:{customField:e,value:o.ou.fromJSDate(a).startOf("day").toISO()}})},dateFormat:"MMM dd, yyyy",calendarClassName:"tailwind-calendar",customInput:(0,l.jsx)(h.Z,{hint:o.ou.now().toFormat("DD"),onClear:function(){return B({type:"SET_CUSTOM_FIELD",data:{customField:e,value:null}})}})})]},a);case"checkbox":var s;return(0,l.jsxs)("div",{className:"flex flex-col md:min-w-40 w-full",children:[(0,l.jsx)("label",{className:"mb-1",children:e.name}),(0,l.jsx)("div",{className:"flex flex-wrap gap-x-6 gap-y-2",children:null===(s=e.options)||void 0===s?void 0:s.map((function(a){return(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",className:"mr-1",value:a.id,checked:!!(null===t||void 0===t?void 0:t.includes(a.id)),onChange:function(t){return B({type:"SET_CUSTOM_FIELD",data:{customField:e,value:a.id,checked:t.target.checked,fieldType:"checkbox"}})}}),a.name]},a.id)}))})]},a);case"dropdown":return(0,l.jsx)(p.Z,{className:"w-full",value:e.options.find((function(e){return e.id===t})),onChange:function(a){return B({type:"SET_CUSTOM_FIELD",data:{customField:e,value:a.id}})},values:e.options.filter((function(e){return!e.deleted})),label:e.name,action:q&&(0,l.jsx)(A,{title:"Edit options",onClick:function(){return q({action:"edit",field:e})}})},a);case"rating":return(0,l.jsxs)("div",{className:"flex flex-col md:min-w-40 w-full",children:[(0,l.jsx)("label",{className:"mb-1",children:e.name}),(0,l.jsx)(g.Z,{rating:t||0,setRating:function(a){return B({type:"SET_CUSTOM_FIELD",data:{customField:e,value:a}})}})]},a);default:return(0,l.jsx)(x.Z,{className:"w-full",name:e.name,value:t||"",onChange:function(a){return B({type:"SET_CUSTOM_FIELD",data:{customField:e,value:a}})},type:"text",label:e.name},a)}})):q?(0,l.jsxs)("button",{className:"link w-full h-12 py-2 my-auto bg-white bg-opacity-0 rounded-lg justify-start items-center text-indigo-700 gap-4 inline-flex",onClick:function(){return q({action:"add"})},children:[(0,l.jsx)(f.Z,{className:"w-5 h-5 relative"}),(0,l.jsx)("div",{className:" text-indigo-700 text-sm font-medium leading-none float-left",children:"Add field"})]}):null},$=(0,s.useReducer)(T,E,(function(){return D(E,Z,_)})),X=$[0],B=$[1],G=(0,y.Z)(),Q=(0,s.useMemo)((function(){return new k.c(G)}),[G]),ee=X.data.customer;(0,s.useEffect)((function(){Array.isArray(_)||Q.getCustomFields("customer").then((function(e){B({type:"SET_CUSTOM_FIELDS",data:e})})).catch((function(e){B({type:"SET_CUSTOM_FIELDS",data:[]})}))}),[]),(0,s.useEffect)((function(){B({type:"SET_CUSTOM_FIELDS",data:_})}),[_]),(0,s.useEffect)((function(){U&&B({type:"SET_CUSTOMER",data:Z})}),[U,Z]),(0,s.useEffect)((function(){U||B({type:"RESET_STATE",data:{customer:E.data.customer,customFields:_}})}),[U]);var ae=(0,m.useSession)().data,te=(0,b.Z)(),le=te.confirm,se=te.ConfirmDialog,ie=X.data.customFields.filter((function(e){var a=e.name;return"Status"===a||"Source"===a})),ne=X.data.customFields.filter((function(e){var a=e.name;return"Status"!==a&&"Source"!==a}));return(0,l.jsx)(i.u.Root,{show:U,as:s.Fragment,children:(0,l.jsxs)(n.V,{as:"div",className:"fixed inset-0 z-100",onClose:Y,children:[(0,l.jsx)(i.u.Child,{as:s.Fragment,enter:"ease-in-out duration-400",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in-out duration-400",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,l.jsx)(n.V.Overlay,{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-2xs transition-opacity"})}),(0,l.jsxs)("div",{className:"fixed inset-y-0 w-full max-w-full md:w-auto right-0 flex",children:[(0,l.jsx)(i.u.Child,{as:s.Fragment,enter:"transform transition ease-in-out duration-500 sm:duration-700",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:(0,l.jsx)("div",{className:"relative transition-all md:max-w-sm w-full",children:(0,l.jsxs)("div",{className:"relative h-full w-screen max-w-full items-stretch flex flex-col bg-white shadow-xl overflow-y-auto overflow-x-hidden",children:[(0,l.jsxs)("div",{className:"max-w-full sticky top-0 flex items-center justify-between bg-white border-b z-10 p-4 lg:p-6",children:[(0,l.jsx)(n.V.Title,{className:"font-bold text-gray-900",children:ee?ee._id?"".concat(ee.firstName," ").concat(ee.lastName):"Add Contact":"Add new contact"}),(0,l.jsxs)("button",{type:"button",className:"flex-shrink-0",onClick:Y,children:[(0,l.jsx)("span",{className:"sr-only",children:"Close panel"}),(0,l.jsx)(r.Z,{className:"h-5 w-5","aria-hidden":"true"})]})]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col p-4 ",children:[(0,l.jsxs)("div",{className:"flex flex-col divide-y gap-4 pb-6",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-4 pb-4",children:[(0,l.jsx)("p",{className:"font-bold text-gray-900 mb-3",children:"Personal info "}),(0,l.jsx)(x.Z,{className:"w-full",name:"firstName",error:!X.ui.isValid&&(!ee||!ee.firstName||!/[a-z]/gi.test(ee.firstName)),value:ee?ee.firstName:"",onChange:function(e){return B({type:"SET_FIELD",data:{field:"firstName",value:e}})},type:"text",label:"First name"}),(0,l.jsx)(x.Z,{className:"w-full",name:"lastName",value:ee?ee.lastName:"",onChange:function(e){return B({type:"SET_FIELD",data:{field:"lastName",value:e}})},type:"text",label:"Last name"}),!X.ui.isValid&&(!ee||!ee.firstName||!/[a-z]/gi.test(ee.firstName))&&(0,l.jsx)("div",{className:"w-full mt-2 text-sm text-red-600",children:"You must provide a valid first name"}),(0,l.jsx)(x.Z,{className:"w-full ",error:X.ui.isValid||ee&&ee.email&&(0,v.oH)(ee.email)?"":"You must provide a valid email",name:"email",value:ee?ee.email:"",onChange:function(e){return B({type:"SET_FIELD",data:{field:"email",value:e}})},type:"text",label:"Email"}),(0,l.jsx)(x.Z,{className:"w-full",name:"phone",value:ee?ee.phone:"",onChange:function(e){return B({type:"SET_FIELD",data:{field:"phone",value:e}})},type:"text",label:"Phone"}),(0,l.jsx)(x.Z,{className:"w-full",name:"company",value:ee?ee.company:"",onChange:function(e){return B({type:"SET_FIELD",data:{field:"company",value:e}})},type:"text",label:"Company"}),W(ie)]}),(0,l.jsxs)("div",{className:"flex flex-col gap-6 pb-4",children:[(0,l.jsx)("p",{className:"font-bold text-gray-900 mt-6",children:"Address"}),(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)(x.Z,{className:"w-full",name:"line1",value:ee&&ee.address?ee.address.line1:"",onChange:function(e){return B({type:"SET_ADDRESS_FIELD",data:{field:"line1",value:e}})},type:"text",label:"Line 1"}),(0,l.jsx)(x.Z,{className:"w-full",name:"line2",value:ee&&ee.address?ee.address.line2:"",onChange:function(e){return B({type:"SET_ADDRESS_FIELD",data:{field:"line2",value:e}})},type:"text",label:"Line 2"}),(0,l.jsx)(x.Z,{className:"w-full",name:"city",value:(null===ee||void 0===ee||null===(a=ee.address)||void 0===a?void 0:a.city)||"",onChange:function(e){return B({type:"SET_ADDRESS_FIELD",data:{field:"city",value:e}})},type:"text",label:"City"}),(0,l.jsx)(x.Z,{className:"w-full",name:"state",value:(null===ee||void 0===ee||null===(t=ee.address)||void 0===t?void 0:t.state)||"",onChange:function(e){return B({type:"SET_ADDRESS_FIELD",data:{field:"state",value:e}})},type:"text",label:(0,I.rv)(null===ee||void 0===ee||null===(d=ee.address)||void 0===d||null===(j=d.country)||void 0===j?void 0:j.code)}),(0,l.jsx)(p.Z,{className:"w-full",value:v.hW.find((function(e){var a,t,l;return e.code===((null===ee||void 0===ee||null===(a=ee.address)||void 0===a?void 0:a.country)||(null===ae||void 0===ae||null===(t=ae.user)||void 0===t||null===(l=t.location)||void 0===l?void 0:l.toUpperCase()))})),onChange:function(e){var a=e.code;B({type:"SET_ADDRESS_FIELD",data:{field:"country",value:a}})},values:v.hW,label:"Country",hasFilter:!0}),(0,l.jsx)(x.Z,{className:"w-full",name:"zipCode",value:(null===ee||void 0===ee||null===(F=ee.address)||void 0===F?void 0:F.postalCode)||"",onChange:function(e){return B({type:"SET_ADDRESS_FIELD",data:{field:"postalCode",value:e}})},type:"text",label:(0,I.p2)(null===ee||void 0===ee||null===(S=ee.address)||void 0===S||null===(w=S.country)||void 0===w?void 0:w.code)})]})]}),(0,l.jsxs)("div",{className:(0,v.AK)("flex flex-col gap-4 ",q&&ne.length?"pt-6":"pt-2"),children:[q&&ne.length>0&&(0,l.jsxs)("div",{className:"w-full h-5 bg-white items-center justify-between gap-4 inline-flex",children:[(0,l.jsx)("div",{className:"grow shrink basis-0 h-5 justify-start items-center gap-2 flex",children:(0,l.jsx)("div",{className:"grow shrink basis-0 flex-col justify-start items-start gap-1 inline-flex",children:(0,l.jsx)("div",{className:"self-stretch text-gray-900 text-base font-semibold leading-tight",children:"Custom fields"})})}),(0,l.jsx)("div",{className:"justify-end items-center gap-2.5 flex",children:(0,l.jsx)("button",{className:"link text-sm font-medium leading-none",disabled:O||J,onClick:function(){return q({action:"manage"})},children:"Manage fields"})})]}),W(ne)]})]}),(null===ee||void 0===ee?void 0:ee._id)&&!M&&(0,l.jsxs)("div",{className:"flex flex-col w-full py-6",children:[(0,l.jsx)("p",{className:(0,v.AK)("font-bold text-gray-900 mb-3",(null===ee||void 0===ee?void 0:ee._id)?"mt-4":"mt-8"),children:"Feedback"}),(0,l.jsx)("div",{className:"border p-4 block bg-gray-50 rounded text-body",children:(null===ee||void 0===ee?void 0:ee.rating)?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(g.Z,{className:"block",rating:ee.rating||0,readOnly:!0}),Array.isArray(ee.reviewRequested)&&ee.reviewRequested.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{className:"mt-4 font-medium",children:"You requested for their reviews on:"}),(0,l.jsx)("ul",{className:"mt-2 text-body-sm gap-1 flex flex-col",children:null===(C=ee.reviewRequested)||void 0===C?void 0:C.map((function(e){return(0,l.jsx)("li",{children:o.ou.fromISO(e).toFormat("MMM dd, yyyy @ HH:mm:ss")},e)}))})]}):""]}):"".concat(null===ee||void 0===ee?void 0:ee.firstName," has not yet left feedback for your business!")})]})]}),(0,l.jsx)("div",{className:(0,v.AK)("sticky left-0 right-0 z-50 flex items-center justify-end gap-3 p-4 lg:px-6 bg-white  transition-all duration-300",X.ui.isDirty?"bottom-0 opacity-100 border-t border-gray-100":"-bottom-20 opacity-0","bottom-0 opacity-100"),children:X.ui.isDirty&&(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(N.Z,{className:"light",disabled:O,onClick:function(){return P()},children:X.ui.isDirty?"Discard":"Cancel"}),(0,l.jsx)(N.Z,{className:"primary",onClick:function(){return function(){if(X.ui.isValid){if(z)return z(ee),setTimeout((function(){return V(ee)}),20);V(ee)}}()},loading:O,disabled:!X.ui.isValid,children:"Save"})]})})]})})}),(0,l.jsx)(se,{attention:!0,confirmText:"Discard"})]})]})})}}}]);