"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3994],{43994:function(e,t,n){n.d(t,{w:function(){return ie}});var i=n(26042),r=n(69396),o=n(29815),s=n(85893),a=n(67294),l=n(38622),d=n(11355),u=n(69737),c=n(66261),f=(0,a.createContext)((function(){})),m=(0,a.createContext)((function(){})),h=n(47568),p=n(51438),v=n(52951),g=n(97582),x=n(3732),y=function(){function e(t){var n=t.get,i=t.post,r=t.remove,o=t.put;(0,p.Z)(this,e),this.get=n,this.post=i,this.put=o,this.delete=r}return(0,v.Z)(e,[{key:"getCustomFields",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"customer",t=this;return(0,h.Z)((function(){var n;return(0,g.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.get("/custom-field/get-by-category",{category:e})];case 1:if(!0===(null===(n=i.sent())||void 0===n?void 0:n.status)&&(null===n||void 0===n?void 0:n.content))return(0,x.Fs)("".concat(e,'.custom-fields", response.content')),[2,n.content];throw new Error("Failed to get custom fields: ".concat(null===n||void 0===n?void 0:n.message))}}))}))()}},{key:"deleteCustomField",value:function(e){var t=this;return(0,h.Z)((function(){var n;return(0,g.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.post("/custom-field/delete",{idCustomField:e._id})];case 1:if((n=i.sent())&&!0===n.status)return[2,n.content];throw new Error("Failed to delete custom field: ".concat(null===n||void 0===n?void 0:n.message))}}))}))()}},{key:"createCustomField",value:function(e){var t=this;return(0,h.Z)((function(){var n;return(0,g.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.post("/custom-field/create",e)];case 1:if((n=i.sent())&&!0===n.status)return[2,n.content];throw new Error("Failed to create custom field: ".concat(null===n||void 0===n?void 0:n.message))}}))}))()}},{key:"updateCustomField",value:function(e){var t=this;return(0,h.Z)((function(){var n;return(0,g.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.post("/custom-field/edit",(0,r.Z)((0,i.Z)({},e),{idCustomField:e._id}))];case 1:if((n=o.sent())&&!0===n.status)return[2,n.content];throw new Error("Failed to create custom field: ".concat(null===n||void 0===n?void 0:n.message))}}))}))()}}]),e}(),b=n(10253),j=n(43443);function w(e){return Array.isArray(e)?{customFields:e.filter((function(e){return!e.default})),defaultFields:e.filter((function(e){return e.default}))}:{customFields:[],defaultFields:[]}}function F(e){switch(e){case"manage":default:return"list";case"new":case"add":return"add";case"edit":return"edit";case"select":return"select"}}function C(e){switch(e){case"add":case"create":return"Fields added here are also added to contacts in your CRM";case"edit":return"Changes made here will be reflected on contacts in your CRM";default:return""}}function Z(e,t){var n=t.oldIndex,i=t.newIndex;return e.default&&0===i&&(i=1),(0,j.Rp)(e.options,n,i)}function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e((function(e){var n=e.options||[],s=n.every((function(e){return!!e.name}))&&!t.length;return(0,r.Z)((0,i.Z)({},e),{options:s?(0,o.Z)(n).concat([{id:n.length,name:"",new:!0}]):n})}))}function k(e){var t=e.filter((function(e){return!e.deleted})).map((function(e){return e.name.toLowerCase().trim()})),n=new Set(t);return t.length!==n.size}var _={_id:null,name:"",type:null,options:[]},A=n(4519),S=n(52077),E=n(16494),T=n(36338),M=n(13840),D=n(57349),K=n(53901);function L(e){var t=e.type,n=e.className,i=function(e){switch(e){case"number":return"#";case"money":return"$";case"text":return"A";default:return null}}(t);return i?(0,s.jsx)("div",{className:(0,x.AK)("relative bg-white bg-opacity-0 h-5 w-5",n),children:(0,s.jsxs)("div",{className:"h-fit left-0 top-0 absolute text-center group-hover:text-indigo-600 text-gray-500 text-lg font-normal font-['SF Pro Rounded'] leading-tight ",children:[i,(0,s.jsx)("span",{className:"pr-[2px] border-r-1 border-r-gray-500 h-4 inline-block relative top-[1px]"})]})}):function(e,t){var n="rounded border border-gray-500";switch(e){case"date":return(0,s.jsx)(T.Z,{className:t});case"checkbox":return(0,s.jsx)(M.Z,{className:(0,x.AK)(t,n)});case"dropdown":return(0,s.jsx)(D.Z,{className:(0,x.AK)(t,n)});case"rating":return(0,s.jsx)(K.Z,{className:t});default:throw new Error("Unknown type ".concat(e))}}(t,(0,x.AK)("flex-none text-gray-500 group-hover:text-indigo-600 h-5 w-5",n))}var I=[{id:1,value:"text",name:"Text",description:"Type in a single line of text, like a name or note"},{id:2,value:"number",name:"Number",description:"Type in in a number without decimals or fractions"},{id:3,value:"money",name:"Money",description:"Type in a monetary value, with currency"},{id:4,value:"date",name:"Date",description:"Select a day of the year from a calendar"},{id:5,value:"checkbox",name:"Checkbox",description:"One or more yes or no choices"},{id:6,value:"dropdown",name:"Dropdown",description:"Select a single choice from a menu of options you define"},{id:7,value:"rating",name:"Rating",description:"An input for a rating from 1 to 5 stars"}];function R(){var e=function(e){var n=e.value,s=[];"dropdown"!==n&&"checkbox"!==n||s.push({id:0,name:"",default:!1}),l("edit"),o((function(e){return(0,r.Z)((0,i.Z)({},e),{type:n,category:t,options:s})}))},t=(0,a.useContext)(f).data.category,n=(0,a.useContext)(m),o=n.setActiveField,l=n.updateView;return(0,s.jsxs)("div",{className:"",children:[(0,s.jsx)("label",{className:"text-gray-900 text-sm font-normal leading-none mb-4",children:"Select the type of input"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:I.map((function(t){return(0,s.jsx)("div",{className:"p-4 bg-white bg-opacity-0 rounded-lg border border-gray-300 justify-start items-center gap-4 inline-flex hover:bg-indigo-50 hover:border-indigo-600 cursor-pointer focus:border-1",onKeyDown:function(n){return function(t,n){"Enter"===t.key&&e(n)}(n,t)},onClick:function(){return e(t)},autoFocus:!0,role:"button",tabIndex:0,children:(0,s.jsxs)("div",{className:"grow shrink basis-0 justify-start items-start gap-3 flex",children:[(0,s.jsx)(L,{type:t.value,className:"flex-none"}),(0,s.jsxs)("div",{className:"grow shrink basis-0 flex-col justify-start items-start gap-1 inline-flex",children:[(0,s.jsx)("div",{className:"self-stretch text-gray-900 text-base font-semibold leading-tight",children:t.name}),(0,s.jsx)("div",{className:"self-stretch text-gray-500 text-sm font-normal leading-tight",children:t.description})]})]})},t.id)}))})]})}var B=n(51351),W=n(78680);function O(e){var t=e.title,n=e.onClick,i=e.className,r=e.disabled,o=e.fullWidth;return(0,s.jsxs)("button",{className:(0,x.AK)("link flex items-center gap-4 cursor-pointer text-indigo-700 hover:bg-gray-50 py-2 focus:border-1 focus:ring-indigo-500 focus:border-indigo-500",o&&"w-full py-4 px-4",i),onClick:n,disabled:r,children:[(0,s.jsx)(W.Z,{className:"w-5 h-5"}),(0,s.jsx)("p",{className:"text-sm font-medium leading-non",children:t})]})}var P=n(60728),V=n(20402),q=n(78017),z=n(51121),J="focus:border-1 focus:ring-indigo-500 focus:border-indigo-500";function U(e){var t=e.field,n=e.confirm,o=e.loading,l=e.editable,d=e.selectable,u=e.selected,c=e.disabled,f=e.onSelectChange,h=e.required,p=e.hideType,v=function(e){e&&e.stopPropagation(),C("edit"),j(t)},g=(0,a.useContext)(m),b=g.onError,j=g.setActiveField,w=g.setCustomFields,F=g.setLoading,C=g.updateView,Z=(0,A.Z)(),N=new y(Z),k=t.name,_=t.type;return(0,s.jsxs)("div",{className:(0,x.AK)("w-full py-2 px-4 rounded-lg justify-start items-center gap-4 inline-flex cursor-pointer",h?"bg-gray-50":"bg-white bg-opacity-0",!c&&"hover:bg-gray-50",_&&!p?"h-14":"h-10"),onClick:function(){if(d&&!c)return f(t,!u);l&&v()},children:[d?h?(0,s.jsx)(M.Z,{className:"w-5 h-5 relative text-gray-300"}):(0,s.jsx)(z.Z,{type:"checkbox",disabled:c,checked:u,onChange:function(e,n){var i=n.target;f(t,i.checked)}}):null,(0,s.jsxs)("div",{className:"w-full grow shrink basis-1 flex-col justify-start items-start inline-flex",onClick:function(){if(d&&!c)return f(t,!u);l&&v()},children:[(0,s.jsx)("div",{className:(0,x.AK)("self-stretch text-sm font-medium leading-tight cursor-pointer",c?"text-gray-400":"text-gray-900"),children:k}),_&&!p&&(0,s.jsx)("div",{className:"self-stretch text-gray-500 text-sm font-normal leading-tight capitalize cursor-pointer",children:_})]}),(0,s.jsx)("div",{className:"bg-white bg-opacity-0 justify-end items-start gap-1 flex",children:l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:(0,x.AK)("link w-10 h-10 bg-white bg-opacity-0 rounded justify-center items-center flex",J),disabled:o,onClick:v,children:(0,s.jsx)(V.Z,{className:"w-5 h-5 relative text-indigo-600"})}),(0,s.jsx)("button",{className:(0,x.AK)("link w-10 h-10 bg-white bg-opacity-0 rounded justify-center items-center flex cursor-pointer",J),disabled:o,onClick:function(e){e.stopPropagation(),n(null,null,(function(){F((function(e){return(0,r.Z)((0,i.Z)({},e),{deleteField:!0})})),N.deleteCustomField(t).then((function(){w((function(e){return(0,r.Z)((0,i.Z)({},e),{customFields:e.customFields.filter((function(e){return e._id!==t._id}))})})),d&&u&&f(t,!1),F((function(e){return(0,r.Z)((0,i.Z)({},e),{deleteField:!1})})),x.Z9.success("Custom field deleted")})).catch((function(e){b(e),F((function(e){return(0,r.Z)((0,i.Z)({},e),{deleteField:!1})}))}))}),null)},children:o?(0,s.jsx)(E.Z,{text:""}):(0,s.jsx)(q.Z,{className:"w-5 h-5 relative text-red-600"})})]}):null})]})}function H(e){e=null!==e?e:(0,B.Z)(new TypeError("Cannot destructure undefined"));var t=(0,a.useContext)(f),n=t.data.customFields,i=t.ui.loading,r=(0,a.useContext)(m).updateView,o=(0,P.Z)(),l=o.confirm,d=o.ConfirmDialog;return n&&n.length?(0,s.jsxs)("div",{className:"flex-col justify-start items-start gap-0 inline-flex",children:[n.map((function(e){return(0,s.jsx)(U,{field:e,confirm:l,loading:i.deleteField,editable:!0},e._id)})),(0,s.jsx)(O,{title:"Add field",onClick:function(){return r("add")},fullWidth:!0,disabled:i.deleteField}),(0,s.jsxs)(d,{attention:!0,confirmText:"Delete",title:"Delete custom field",children:[(0,s.jsx)("p",{children:"Are you sure you want to delete this custom field?"}),(0,s.jsxs)("div",{className:"alert danger mt-4",children:[(0,s.jsx)(c.Z,{icon:"ExclamationIcon"}),(0,s.jsx)("p",{children:"Removing this field, will remove it from every contact, not only this one. It will also be removed from any contact forms."})]})]})]}):(0,s.jsx)("div",{children:(0,s.jsx)(O,{title:"Add field",onClick:function(){return r("add")},fullWidth:!0})})}var X=(0,j.W6)((function(e){var t=e.disabled;return(0,s.jsx)(c.Z,{icon:"DragIcon",className:(0,x.AK)("w-5 h-5 relative",t?"text-gray-300":"text-gray-900 cursor-move")})})),$=(0,j.W8)((function(e){var t=e.option,n=e.isDisabled,o=e.disableDelete,l=e.error,d=e.focused,u=function(e){c((function(n){return(0,r.Z)((0,i.Z)({},n),{options:n.options.map((function(n){return n.id===t.id?(0,r.Z)((0,i.Z)({},n),{name:e}):n}))})}))},c=(0,a.useContext)(m).setActiveField,h=(0,a.useContext)(f).ui.optionDuplicateIds;return(0,s.jsxs)("div",{className:"self-stretch py-2 bg-white bg-opacity-0 justify-start items-center gap-4 inline-flex w-full z-100",children:[(0,s.jsx)(X,{disabled:n}),(0,s.jsx)(z.Z,{value:t.name,disabled:n,inputClassName:"w-full",className:"w-full",title:n?"Default fields cannot be deleted":"",onKeyUp:function(e){"Enter"===e.key&&t.name.length&&N(c,h)},onBlur:function(){var e;u(null===(e=t.name)||void 0===e?void 0:e.trim())},onChange:u,error:l,autoFocus:d}),(0,s.jsx)("button",{className:(0,x.AK)("link w-10 h-10 bg-white bg-opacity-0 rounded justify-center items-center flex",!n&&"cursor-pointer"),disabled:n||o,onClick:function(){n||c((function(e){var n=function(e,t){var n=t.id;return e._id?t.new?e.options.filter((function(e){return e.id!==n})):e.options.map((function(e){return e.id===n?(0,r.Z)((0,i.Z)({},e),{deleted:!0}):e})):e.options.filter((function(e){return e.id!==n}))}(e,t);return(0,r.Z)((0,i.Z)({},e),{options:n})}))},children:(0,s.jsx)(q.Z,{className:(0,x.AK)("w-5 h-5 relative",n||o?"text-gray-300":"text-red-600")})})]})})),G=(0,j.JN)((function(e){var t=e.children;return(0,s.jsx)("div",{className:"bg-white relative z-5 w-full",children:t})}));function Q(e){var t,n=e.field,o=e.onSave,l=e.loading,d=function(e){p((function(t){return(0,r.Z)((0,i.Z)({},t),{name:e||""})}))},u=(0,a.useContext)(f).ui,c=u.validationErrors,h=u.optionDuplicateIds,p=(0,a.useContext)(m).setActiveField,v=(0,a.useRef)(null),g=n.name,x=(0,a.useMemo)((function(){var e,t;return!(null===(e=n.options)||void 0===e?void 0:e.length)||(null===(t=n.options[n.options.length-1].name)||void 0===t?void 0:t.trim().length)}),[n.options]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.Z,{ref:v,label:"Label",inputClassName:"w-full",className:"w-full",value:g,onKeyUp:function(e){var t;if("Enter"===e.key&&g.trim().length&&!(null===(t=n.options)||void 0===t?void 0:t.length)){var i=g.trim();d(i),o()}},onBlur:function(){var e=g.trim();d(e)},onChange:function(e){return d(e)},disabled:n.default||l,error:null===c||void 0===c?void 0:c.label,autoFocus:!0}),(null===(t=n.options)||void 0===t?void 0:t.length)?(0,s.jsxs)("div",{className:"self-stretch flex-col justify-start items-start gap-2 flex",children:[(0,s.jsxs)("div",{className:"text-gray-900 text-sm font-normal leading-none mt-4",children:[(0,s.jsx)("span",{className:"capitalize",children:n.type})," options"]}),(0,s.jsx)(G,{onSortEnd:function(e){p((function(t){return(0,r.Z)((0,i.Z)({},t),{options:Z(t,e)})}))},distance:10,useDragHandle:!0,helperClass:"border-t border-b after:hidden",lockAxis:"y",lockToContainerEdges:!0,children:n.options.map((function(e,t){if(e.deleted)return null;var i=n.default&&0===t;return(0,s.jsx)($,{index:t,option:e,disabled:i||l,isDisabled:i||l,disableDelete:1===n.options.length,error:h.includes(e.id),focused:!!g},e.id)}))}),(null===c||void 0===c?void 0:c.options)&&(0,s.jsx)("p",{className:"mt-2 text-sm text-red-500",children:c.options}),(0,s.jsx)(O,{title:"Add option",onClick:function(){return N(p,h)},fullWidth:!0,disabled:!x})]}):null]})}var Y=n(94874),ee=[{_id:"name",name:"Name",fieldName:"fullName",required:!0,fieldType:"standard"},{_id:"email",name:"Email",fieldName:"email",required:!0,fieldType:"standard"},{_id:"phone",name:"Phone",fieldName:"phone",fieldType:"standard"},{_id:"company",name:"Company",fieldName:"company",fieldType:"standard"}];function te(e,t){return!(!e||!e.length)&&e.includes(t._id)}function ne(e){var t=e.country,n=e.selectedFields,i=e.onSelectedFieldsChange,r=function(e,t){var r=function(e,t,n){if(n){var i=(0,o.Z)(e).concat([t._id]);return"address:full"===t._id?i.filter((function(e){return"address:full"===e._id&&"address"!==e.type||!e.startsWith("address:")})):[]}return e.filter((function(e){return e!==t._id}))}(n,e,t);i(r,e,t)},l=(0,a.useContext)(f),d=l.data.customFields,u=l.ui.loading,h=(0,P.Z)(),p=h.confirm,v=h.ConfirmDialog,g=(0,a.useContext)(m).updateView,x=(0,a.useMemo)((function(){return function(e){return[{_id:"address:full",name:"Full address",fieldName:"address:full",fieldType:"address"},{_id:"address:city",name:"City",fieldName:"address:city",fieldType:"address"},{_id:"address:state",name:(0,Y.rv)(e),fieldName:"address:state",fieldType:"address"},{_id:"address:country",name:"Country",type:"dropdown",fieldName:"address:country",fieldType:"address"},{_id:"address:postalCode",name:(0,Y.p2)(e),fieldName:"address:postalCode",fieldType:"address"}]}(t)}),[t]);return(0,s.jsxs)("div",{className:"flex-col justify-start items-start gap-2 inline-flex",children:[(0,s.jsx)("div",{className:"self-stretch flex-col justify-start items-start gap-2 flex pb-4",children:(0,s.jsx)("div",{className:"text-gray-900 text-sm font-normal leading-none",children:"Fields from your CRM contacts"})}),ee.map((function(e){return(0,s.jsx)(U,{field:e,selectable:!0,selected:e.required||te(n,e),disabled:e.required,required:e.required,onSelectChange:r},e.id)})),(0,s.jsx)("hr",{className:"my-0 w-full"}),x.map((function(e){var t=function(e,t){var n=t.some((function(e){return e.startsWith("address:")}));if(!n)return!1;var i=t.includes("address:full");return("address:full"!==e._id||!i)&&i}(e,n);return(0,s.jsx)(U,{field:e,selectable:!0,selected:t||te(n,e),onSelectChange:r,disabled:t,hideType:!0},e.id)})),(0,s.jsx)("hr",{className:"my-0 w-full"}),d.map((function(e){return(0,s.jsx)(U,{field:e,confirm:p,loading:u.deleteField,selectable:!0,editable:!0,selected:te(n,e),onSelectChange:r},e._id)})),(0,s.jsx)(O,{title:"Add field",onClick:function(){return g("add")},fullWidth:!0,disabled:u.deleteField}),(0,s.jsxs)(v,{attention:!0,confirmText:"Delete",title:"Delete custom field",children:[(0,s.jsx)("p",{children:"Are you sure you want to delete this custom field?"}),(0,s.jsxs)("div",{className:"alert danger mt-4",children:[(0,s.jsx)(c.Z,{icon:"ExclamationIcon"}),(0,s.jsx)("p",{children:"Removing this field, will remove it from any contact forms as well as from all contacts in your CRM."})]})]})]})}var ie=(0,a.memo)((function(e){var t=e.action,n=void 0===t?"list":t,h=e.category,p=e.country,v=void 0===p?"us":p,g=e.customFields,j=e.customFieldsLoading,Z=e.field,N=e.info,T=e.onUpdate,M=e.open,D=e.setOpen,K=e.selectedFields,L=void 0===K?[]:K,I=e.onSelectedFieldsChange,B=function(e){var t=w(e);$(t),ae((function(e){return(0,r.Z)((0,i.Z)({},e),{customFields:!1})}))},W=function(e){x.Z9.error((null===e||void 0===e?void 0:e.message)||e||""),console.error(e)},O=function(e){e&&ve((function(t){return t[t.length-1]===e?t:(0,o.Z)(t).concat([e])}))},P=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0===pe.length)return ye("list",!0),void ue(Z||_);var n=pe[pe.length-1],o=1;t&&"add"===n&&(n=pe[pe.length-2],o=2),$((function(t){return(0,r.Z)((0,i.Z)({},t),{customFields:(null===e||void 0===e?void 0:e.customFields)?e.customFields:t.customFields,defaultFields:(null===e||void 0===e?void 0:e.defaultFields)?e.defaultFields:t.defaultFields})})),ye(n,!0),ue(Z||_),ve((function(e){return e.slice(0,e.length-o)}))},V=function(){pe.length>0?P():D(!1)},q=function(e){var t=de._id?X.customFields.map((function(t){return t._id===e._id?e:t})):(0,o.Z)(X.customFields).concat([e]),s=X.defaultFields.map((function(t){return t._id===e._id?e:t}));if(ae((function(e){return(0,r.Z)((0,i.Z)({},e),{saveField:!1})})),"edit"===n&&(null===Z||void 0===Z?void 0:Z._id)===e._id)return $((function(e){return(0,r.Z)((0,i.Z)({},e),{customFields:t,defaultFields:s})})),ve([]),D(!1);P({customFields:t,defaultFields:s},!0)},z=(0,A.Z)(),J=(0,a.useMemo)((function(){return new y(z)}),[z]),U=(0,a.useState)(w(g)),X=U[0],$=U[1],G=(0,a.useState)(h),Y=G[0],ee=G[1],te=(0,a.useState)(F(n)),ie=te[0],re=te[1],oe=(0,a.useState)({customFields:!1,deleteField:!1,saveField:!1}),se=oe[0],ae=oe[1],le=(0,a.useState)(Z||_),de=le[0],ue=le[1],ce=(0,a.useState)(""),fe=ce[0],me=ce[1],he=(0,a.useState)([]),pe=he[0],ve=he[1],ge=(0,a.useRef)(null),xe=(0,a.useMemo)((function(){return j||Object.values(se).some((function(e){return e}))}),[se,j]),ye=(0,a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||O(ie),re(F(e)),me(C(e))}),[ie,n]);(0,a.useEffect)((function(){void 0===g&&void 0===j&&(ae((function(e){return(0,r.Z)((0,i.Z)({},e),{customFields:!0})})),J.getCustomFields(Y).then(B).catch((function(e){W(e),ae((function(e){return(0,r.Z)((0,i.Z)({},e),{customFields:!1})}))})))}),[]),(0,a.useEffect)((function(){B(g)}),[g]),(0,a.useEffect)((function(){ee(h)}),[h]),(0,a.useEffect)((function(){ue(Z||_)}),[Z]),(0,a.useEffect)((function(){ye(n)}),[n]),(0,a.useEffect)((function(){M||setTimeout((function(){V()}),300)}),[M]),(0,a.useEffect)((function(){if(!ie&&pe.length<1&&M)return D(!1)}),[pe.length,ie,D,M]),(0,a.useEffect)((function(){if(M&&!j&&T){var e=(0,o.Z)(X.defaultFields).concat((0,o.Z)(X.customFields));JSON.stringify(e)!==JSON.stringify(g)&&T(e)}}),[X]);var be=(0,a.useMemo)((function(){if("edit"!==ie)return!1;var e=function(e,t){return t._id?e.find((function(e){return e._id===t._id})):null}(X.customFields,de);if(!e){var t=de.name,n=de.options;return!!t||n.length>0&&n[0].name}return JSON.stringify(e)!==JSON.stringify(de)}),[X.customFields,de,ie]),je=(0,a.useMemo)((function(){var e;return"edit"!==ie||!!(null===(e=de.name)||void 0===e?void 0:e.trim().length)&&("dropdown"!==de.type&&"checkbox"!==de.type||!k(de.options)&&de.options.length>0)}),[ie,de]),we=(0,a.useCallback)((function(){if(je&&!xe){ae((function(e){return(0,r.Z)((0,i.Z)({},e),{saveField:!0})}));var e,t=function(e){if(!(null===e||void 0===e?void 0:e.options)||!Array.isArray(e.options))return e;if(!e._id)return e;if(e.options.filter((function(e){return e.deleted})).length<1)return e;var t=Map.groupBy?Map.groupBy(e.options,(function(e){return e.name.toLowerCase()})):Array.prototype.groupToMap(e.options,(function(e){return e.name.toLowerCase()})),n=!0,r=!1,o=void 0;try{for(var s,a=function(){var t=(0,b.Z)(s.value,2),n=(t[0],t[1]);if(n.length<2)return"continue";var i=n.find((function(e){return e.deleted}));e.options=e.options.filter((function(e){return e.id!==i.id})),i.deleted=!1;var r=e.options.findLastIndex((function(e){return e.id===n[n.length-1].id}));e.options.splice(r,1,i)},l=t[Symbol.iterator]();!(n=(s=l.next()).done);n=!0)a()}catch(d){r=!0,o=d}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return(0,i.Z)({},e)}(de);t=(null===(e=t)||void 0===e?void 0:e.options)&&Array.isArray(e.options)?(0,r.Z)((0,i.Z)({},e),{options:e.options.filter((function(e){return e.name}))}):e,(t._id?J.updateCustomField(t):J.createCustomField(t)).then(q).catch((function(e){W(e),ae((function(e){return(0,r.Z)((0,i.Z)({},e),{saveField:!1})}))})),ae((function(e){return(0,r.Z)((0,i.Z)({},e),{saveField:!1})}))}}),[J,de,je,xe]),Fe=(0,a.useMemo)((function(){var e="Back",t=!0;switch(ie){case"add":e="Back";break;case"edit":e=be?"Cancel":"Back";break;case"list":e="Done";break;case"select":e="Cancel",t=!1}return"Back"===e&&pe.length<1&&(e="Close"),(0,s.jsxs)("div",{className:"flex items-end gap-4",children:[t&&(0,s.jsx)("button",{type:"button",className:"light",onClick:V,disabled:xe,children:e}),"select"===ie&&(0,s.jsx)(S.Z,{type:"button",className:"primary",onClick:function(){return D(!1)},loading:xe,children:"Done"}),"edit"===ie&&(0,s.jsx)(S.Z,{type:"button",className:"primary",onClick:we,loading:xe,disabled:!be||!je,children:"Save"})]})}),[ie,be,je,we,xe,pe.length]),Ce=(0,a.useMemo)((function(){if(!N)return null;var e="string"===typeof N?N:fe;return e?(0,s.jsx)(l.Callout,{variant:"info",text:e}):e}),[N,fe]),Ze=(0,a.useMemo)((function(){return function(e,t){switch(e){case"add":return"Add ".concat(t?t.toLowerCase():"a custom"," field");case"edit":return"Edit the ".concat(t?t.toLowerCase():"custom"," field");case"select":return"Manage fields";default:return"Manage custom fields"}}(ie,null===de||void 0===de?void 0:de.type)}),[ie,de]),Ne=(0,a.useMemo)((function(){var e,t=function(e){var t=e.options;if(!Array.isArray(t))return[];if(!k(t))return[];var n=Map.groupBy?Map.groupBy(t,(function(e){return e.name.toLowerCase()})):Array.prototype.groupToMap(t,(function(e){return e.name.toLowerCase()})),i=[],r=!0,s=!1,a=void 0;try{for(var l,d=n[Symbol.iterator]();!(r=(l=d.next()).done);r=!0){var u,c=(0,b.Z)(l.value,2),f=(c[0],c[1]);f.length<2||(u=i).push.apply(u,(0,o.Z)(f.map((function(e){return e.id}))))}}catch(m){s=!0,a=m}finally{try{r||null==d.return||d.return()}finally{if(s)throw a}}return i}(de);return{data:{customFields:X.customFields,defaultFields:X.defaultFields,category:Y,activeField:de,valid:je},ui:{optionDuplicateIds:t,validationErrors:{options:be&&t.length?"Options must be unique":null,label:be&&(null===(e=de.name)||void 0===e?void 0:e.trim().length)<1?"Field must have a label":null},view:ie,loading:se}}}),[de,Y,X.customFields,X.defaultFields,be,je,se,ie]),ke=(0,a.useMemo)((function(){return{setCustomFields:$,setCategory:ee,setActiveField:ue,setLoading:ae,onError:W,updateView:ye}}),[ye]);return(0,s.jsx)(m.Provider,{value:ke,children:(0,s.jsx)(f.Provider,{value:Ne,children:(0,s.jsx)(d.u.Root,{show:M,as:a.Fragment,children:(0,s.jsx)(u.V,{as:"div",className:"fixed z-100 md:inset-0 w-full md:w-auto overflow-hidden bottom-0",initialFocus:ge,onClose:function(){return D(!1)},children:(0,s.jsxs)("div",{className:"flex items-end justify-center min-h-screen text-center md:block",children:[(0,s.jsx)(d.u.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,s.jsx)(u.V.Overlay,{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-2xs transition-opacity"})}),(0,s.jsx)("span",{className:"hidden md:inline-block md:align-middle md:h-screen","aria-hidden":"true",children:"\u200b"}),(0,s.jsx)(d.u.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 md:translate-y-0 md:scale-95",enterTo:"opacity-100 translate-y-0 md:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 md:scale-100",leaveTo:"opacity-0 translate-y-4 md:translate-y-0 md:scale-95",children:(0,s.jsxs)("div",{ref:ge,className:"inline-block align-middle w-full md:w-auto bg-white rounded-t-lg md:rounded-lg md:my-8 text-left overflow-hidden shadow-xl transform transition-all",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 md:py-5 md:px-6 border-b border-gray-200",children:[(0,s.jsx)(u.V.Title,{className:"font-bold text-gray-900",children:Ze}),(0,s.jsx)("button",{type:"button",className:"bg-white rounded-md text-gray-600 border-1 border-transparent transition-all hover:text-gray-400 focus:ring-indigo-500 focus:border-indigo-500",onClick:function(){return D(!1)},children:(0,s.jsx)(c.Z,{icon:"XSolidIcon",className:"h-6 w-6","aria-hidden":"true"})})]}),(0,s.jsxs)("div",{className:(0,x.AK)("p-4 lg:p-6 flex flex-col w-full md:w-140 lg:pb-4 overflow-y-auto max-h-[80vh]","list"===ie&&"lg:px-2"),children:[Ce&&"select"!==ie?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-full mb-0 bg-slate-50 rounded-md justify-start items-start gap-3 inline-flex bg-blue-50",children:Ce}),(0,s.jsx)("hr",{className:"w-full border-gray-200 my-4"})]}):null,function(){if(se.customFields)return(0,s.jsx)(E.Z,{variant:"list"});if(pe.length<1&&!ie)return null;switch(ie){case"add":return(0,s.jsx)(R,{});case"edit":return(0,s.jsx)(Q,{field:de,onSave:we,loading:xe});case"select":return(0,s.jsx)(ne,{country:v,selectedFields:L,onSelectedFieldsChange:I});case"list":return(0,s.jsx)(H,{});default:return console.error("Invalid view ".concat(ie)),(0,s.jsx)(H,{})}}()]}),(0,s.jsx)("div",{className:"flex justify-end p-4 lg:px-6 border-t border-gray-200",children:Fe})]})})]})})})})})}))},94874:function(e,t,n){n.d(t,{VM:function(){return a},oj:function(){return s},p2:function(){return o},rv:function(){return r}});var i=n(3732);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"us";return"ca"===e.toLowerCase()?"Province":"State"}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"us";return"us"===e.toLowerCase()?"ZIP code":"Postal code"}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"us";return"us"===e.toLowerCase()?"label.zipCode":"label.postalCode"}function a(e){var t,n,r="";e&&(r+=e.line1?"".concat(e.line1,", "):"",r+=e.line2?"".concat(e.line2,", "):"",r+=e.city?"".concat(e.city,", "):"",r+=e.state?"".concat(e.state,", "):"",r+=e.country?null!==(n=null===(t=i.hW.find((function(t){return t.code===e.country.toUpperCase()})))||void 0===t?void 0:t.name)&&void 0!==n?n:"".concat(e.country," "):"",r+=e.postalCode?", ".concat(e.postalCode):"");return r.trim()}}}]);