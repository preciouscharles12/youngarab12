"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6589],{67568:function(e,n,t){t.d(n,{S:function(){return u},Z:function(){return c}});var i=t(10253),a=t(85893),o=t(61437),r=t(11355),l=t(67294),s=t(3732);function u(e){var n=e.children,t=e.text,i=e.dirty;e.className;return(0,a.jsx)(r.u,{as:l.Fragment,show:i,enter:"transition-opacity duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsxs)("div",{className:"sticky bottom-0 z-50 flex items-center justify-between gap-3 p-4 sm:px-6 bg-white border-t border-gray-100 lg:rounded-b-lg",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:null!==t&&void 0!==t?t:"Save changes?"}),(0,a.jsx)("div",{className:"flex items-center gap-3",children:n})]})})}function c(e){var n=e.children,t=e.dirty,r=e.className,l=e.fullBorder,u=void 0!==l&&l,c=(0,i.Z)((0,o.Z)("layout.sidebarOpen"),2),d=c[0];c[1];return(0,a.jsx)("div",{className:(0,s.AK)(t?"bottom-0 opacity-100":"-bottom-80 opacity-0","fixed left-0 right-0 z-90 lg:z-50 bg-gray-50 transition-all duration-300 lg:rounded-b-lg",d?"md:left-[15.5rem]":"md:left-24",u?"md:px-0":"md:px-6",r),children:(0,a.jsx)("div",{className:(0,s.AK)("flex items-center justify-between gap-3 py-4 px-6 border-t border-gray-300",u?"md:px-6":"md:px-0"),children:n})})}},22959:function(e,n,t){var i=t(85893),a=t(66605),o=t(16494),r=t(66261),l=t(67294),s=t(3732),u=(0,l.forwardRef)((function(e,n){var t=e.regenerate,l=e.label,u=e.onClick,c=e.disabled,d=e.loading,v=e.asTag,p=void 0===v?"button":v,f=e.className,m=p;return(0,i.jsx)(a.Z,{alt:"Generate content using AI.",children:(0,i.jsx)(m,{disabled:c||d,onClick:u,className:(0,s.AK)("link inline-flex items-center gap-1 text-sm",f),ref:n,children:d?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{children:t?"Regenerating":"Generating"}),(0,i.jsx)(o.Z,{variant:"icon"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{children:null!==l&&void 0!==l?l:t?"Regenerate":"Generate"}),(0,i.jsx)(r.Z,{icon:"BoltIcon",className:"w-4 h-4"})]})})})}));u.displayName="AISuggestionButton",n.Z=u},36589:function(e,n,t){t.d(n,{Z:function(){return B}});var i=t(47568),a=t(26042),o=t(69396),r=t(97582),l=t(85893),s=t(67294),u=t(11355),c=t(33299),d=t(41664),v=t.n(d),p=t(10253),f=t(22959),m=t(53006),g=t(3732),b=t(31488),y=t(76078),h=t(72510),x=t(42734),j=(0,s.forwardRef)((function(e,n){var t=e.prompt,a=e.data,o=e.regenerate,u=e.onSuggestion,c=e.label,d=e.onClick,v=e.onDone,j=e.className,Z=e.applyWritingStyle,T=void 0===Z||Z,E=(0,s.useState)({}),N=E[0],S=E[1],C=(0,p.Z)((0,m.Z)(N),4),_=C[2],R=C[3];function w(e){return O.apply(this,arguments)}function O(){return(O=(0,i.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return d?[4,d()]:[3,2];case 1:n.sent(),n.label=2;case 2:return S({prompt:t,data:a,voiceAndTone:e,applyWritingStyle:T,onContent:u,onDone:function(){S({}),v&&v()}}),[2]}}))}))).apply(this,arguments)}return(0,l.jsxs)("div",{className:(0,g.AK)("flex gap-3 items-center justify-end min-w-40",j),children:[(0,l.jsx)(f.Z,{loading:_,disabled:_,onClick:function(){return w()},regenerate:o,label:c,ref:n}),T&&b.CJ&&(0,l.jsx)(y.Z,{inline:!0,buttonClassName:"link w-full flex items-center text-indigo-700",placementAlign:"end",closeOnSelect:!0,disabled:_,children:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.v.Item,{as:"div",disabled:!0,children:(0,l.jsx)("div",{className:"flex px-4 py-2.5 text-gray-500 text-label cursor-pointer",children:"Writing style"})},"label"),x.i4.filter((function(e){return"tone"===e.type})).map((function(e){return(0,l.jsx)(h.v.Item,{as:"div",disabled:_,children:(0,l.jsxs)("div",{className:"flex flex-col gap-2 px-4 py-2.5 hover:bg-gray-100 text-gray-700 cursor-pointer",onClick:function(){return w(e.id)},children:[(0,l.jsx)("span",{className:"text-sm font-medium",children:e.name}),e.id===R&&(0,l.jsx)("span",{className:"text-label text-gray-500",children:"Brand style"})]})},e.id)}))]})})]})}));j.displayName="AIGenerateButton";var Z=j,T=t(43490),E=t(51121),N=t(88575),S=t(66261),C=t(67568),_=t(52077),R=t(4519),w=t(12280),O={data:{hasToken:!1,tokenIsValid:!1,content:"",subject:""},ui:{toggleOn:!1,subjectError:"",contentError:"",canSave:!1}};function k(e){return e.replace(/<[^>]*>?/gm,"")}function A(e){return e.trim().length<1||k(e).length>2}function I(e,n){return!(e.ui.toggleOn||!n.ui.toggleOn)||e.ui.toggleOn&&!!e.data.content&&!!e.data.subject&&!(e.ui.contentError||e.ui.subjectError)}function F(e,n){var t=n.type,i=n.data,r=n.nylas,l=void 0===r?{}:r,s=n.autoReply,u=void 0===s?{}:s,c=n.style;switch(null===t||void 0===t?void 0:t.toUpperCase()){case"SET_TOGGLE_STATE":var d=(0,a.Z)({},e),v=(0,o.Z)((0,a.Z)({},e),{ui:(0,o.Z)((0,a.Z)({},e.ui),{toggleOn:null===i||void 0===i?void 0:i.value})});return v.ui.canSave=I(v,d),v;case"SET_SUBJECT":var p=(0,a.Z)({},e),f=(0,o.Z)((0,a.Z)({},e.data),{subject:i.ai?"".concat(e.data.subject).concat(i.value):i.value}),m=(0,o.Z)((0,a.Z)({},e),{data:f,ui:(0,o.Z)((0,a.Z)({},e.ui),{subjectError:A(f.subject)?"":"You must provide a valid subject"})});return m.ui.canSave=I(m,p),m;case"SET_CONTENT":var g=(0,a.Z)({},e),b=(0,o.Z)((0,a.Z)({},e.data),{content:i.ai?"".concat(e.data.content).concat(i.value):i.value}),y=(0,o.Z)((0,a.Z)({},e),{data:b,ui:(0,o.Z)((0,a.Z)({},e.ui),{contentError:A(b.content)?"":"You must provide a valid message"})});return y.ui.canSave=I(y,g),y;case"UPDATE_CONFIG":var h=(0,o.Z)((0,a.Z)({},e.data,u),{hasToken:!!(null===l||void 0===l?void 0:l.token),tokenIsValid:!(null===l||void 0===l?void 0:l.invalid)});return(0,o.Z)((0,a.Z)({},e),{data:h,ui:(0,o.Z)((0,a.Z)({},e.ui),{toggleOn:(null===u||void 0===u?void 0:u.enabled)||"modal"===c})});case"RESET_STATE":return(0,o.Z)((0,a.Z)({},O),{data:(0,o.Z)((0,a.Z)({},O.data,u),{hasToken:!!(null===l||void 0===l?void 0:l.token),tokenIsValid:!(null===l||void 0===l?void 0:l.invalid)}),ui:(0,o.Z)((0,a.Z)({},O.ui),{toggleOn:(null===u||void 0===u?void 0:u.enabled)||"modal"===c,canSave:!1})});default:throw new Error("Unknown type ".concat(t))}}function B(e){var n,t,d,p,f,m,b,y,h,x,j,A,I,B,D,G=e.config,U=e.loading,V=void 0!==U&&U,J=e.setLoading,L=void 0===J?function(){}:J,K=e.getConfig,W=e.style,z=void 0===W?"inline":W,M=e.modalOpen,P=void 0!==M&&M,Y=e.setModalOpen,q=function(e){var n,t;return ve?(0,l.jsxs)(l.Fragment,{children:[e&&(0,l.jsx)("div",{className:"flex items-center justify-between gap-6 py-2",children:(0,l.jsx)(T.Z,{label:"Enable Auto-replies",enabled:X.ui.toggleOn,onChange:function(e){return $({type:"SET_TOGGLE_STATE",data:{value:e}})}})}),(0,l.jsxs)(u.u,{as:"div",show:X.ui.toggleOn,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"".concat(e?"py-4 md:py-6 border-t border-gray-200 mt-2":"md:p-2"),children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-1 font-medium",children:[(0,l.jsx)("label",{className:"mb-1",children:"Subject"}),(0,l.jsx)(Z,{ref:ne,regenerate:!!X.data.subject,prompt:"generate-auto-reply",onSuggestion:function(e){return $({type:"SET_SUBJECT",data:{value:e,ai:!0}})},onClick:function(){oe(!0),$({type:"SET_SUBJECT",data:{value:""}})},onDone:function(){oe(!1)},data:{contact:null===H||void 0===H||null===(n=H.user)||void 0===n?void 0:n.name,content:"subject",body:le?"":k(X.data.content)}})]}),(0,l.jsx)(E.Z,{value:X.data.subject,onChange:function(e){return $({type:"SET_SUBJECT",data:{value:e}})},error:X.ui.subjectError})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-1 font-medium",children:[(0,l.jsx)("label",{className:"mb-1",children:"Message"}),(0,l.jsx)(Z,{ref:te,regenerate:!!X.data.content,prompt:"generate-auto-reply",onSuggestion:function(e){return $({type:"SET_CONTENT",data:{value:k(e),ai:!0}})},onClick:function(){se(!0),$({type:"SET_CONTENT",data:{value:""}})},onDone:function(){se(!1)},data:{contact:null===H||void 0===H||null===(t=H.user)||void 0===t?void 0:t.name,content:"body",subject:ae?"":k(X.data.subject)}})]}),(0,l.jsx)(N.Z,{initialValue:X.data.content,onChange:function(e){return $({type:"SET_CONTENT",data:{value:e}})},error:X.ui.contentError})]})]})]}):(0,l.jsx)("div",{children:(0,l.jsx)("p",{className:"text-gray-500 body",children:"Auto-reply is only available on paid plans."})})},H=(0,c.useSession)().data,Q=(0,s.useReducer)(F,(0,o.Z)((0,a.Z)({},O),{ui:(0,o.Z)((0,a.Z)({},O.ui),{toggleOn:"modal"===z})})),X=Q[0],$=Q[1],ee=(0,R.Z)().post,ne=(0,s.useRef)(null),te=(0,s.useRef)(null),ie=(0,s.useState)(!1),ae=ie[0],oe=ie[1],re=(0,s.useState)(!1),le=re[0],se=re[1],ue="inline"===z,ce=null===G||void 0===G||null===(n=G.business)||void 0===n||null===(t=n.nylas)||void 0===t?void 0:t.token,de=!(null===G||void 0===G||null===(d=G.business)||void 0===d||null===(p=d.nylas)||void 0===p?void 0:p.invalid);(0,s.useEffect)((function(){var e,n;$({type:"UPDATE_CONFIG",nylas:null===G||void 0===G||null===(e=G.business)||void 0===e?void 0:e.nylas,autoReply:null===G||void 0===G||null===(n=G.business)||void 0===n?void 0:n.autoReply,style:z})}),[null===G||void 0===G||null===(f=G.business)||void 0===f?void 0:f.nylas,null===G||void 0===G||null===(m=G.business)||void 0===m?void 0:m.autoReply,z]),(0,s.useEffect)((function(){P&&(X.subject||setTimeout((function(){var e;ne&&(null===(e=ne.current)||void 0===e||e.click())}),150),X.content||setTimeout((function(){var e;te&&(null===(e=te.current)||void 0===e||e.click())}),150))}),[P]);var ve=(0,s.useMemo)((function(){var e,n,t;return(null===H||void 0===H||null===(e=H.user)||void 0===e||null===(n=e.plan)||void 0===n||null===(t=n.features)||void 0===t?void 0:t.includes("sync_email"))||!1}),[H.user]),pe=!1,fe=(0,a.Z)({enabled:!1,content:"",subject:""},null===G||void 0===G||null===(b=G.business)||void 0===b?void 0:b.autoReply),me=X.data;function ge(){return be.apply(this,arguments)}function be(){return(be=(0,i.Z)((function(){var e,n;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return X.ui.canSave?(e={enabled:X.ui.toggleOn,content:X.data.content||"",subject:k(X.data.subject)||""},L(!0),[4,ee("/business/save-auto-reply",e).catch(console.log)]):[2];case 1:return!0===(null===(n=t.sent())||void 0===n?void 0:n.status)?(g.Z9.success("Auto reply saved"),K(),Y&&Y(!1)):g.Z9.error(n.message),L(!1),[2]}}))}))).apply(this,arguments)}if(fe.enabled!==X.ui.toggleOn&&(pe=!0),fe.content!==me.content&&(pe=!0),fe.subject!==me.subject&&(pe=!0),ue&&(!ce||!de))return(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"flex md:items-center gap-4 rounded-md bg-blue-50 p-4",children:[(0,l.jsx)(S.Z,{icon:"InformationCircleIcon",className:"h-5 w-5 text-blue-400 flex-shrink-0","aria-hidden":"true"}),(0,l.jsx)("p",{className:"text-sm text-blue-800",children:"Your email needs to be connected before you can send auto-replies."})]})});"Other"===(null===G||void 0===G||null===(y=G.business)||void 0===y||null===(h=y.type)||void 0===h||null===(x=h.Type)||void 0===x?void 0:x.name)?null===G||void 0===G||null===(j=G.business)||void 0===j||null===(A=j.type)||void 0===A||A.name:null===G||void 0===G||null===(I=G.business)||void 0===I||null===(B=I.type)||void 0===B||null===(D=B.Type)||void 0===D||D.name;return ue?(0,l.jsxs)(l.Fragment,{children:[q(ue),(0,l.jsxs)(C.Z,{dirty:pe,children:[(0,l.jsx)("p",{className:"text-sm font-medium",children:"Unsaved"}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("button",{className:"secondary",disabled:V,onClick:function(){var e,n;return $({type:"RESET_STATE",nylas:null===G||void 0===G||null===(e=G.business)||void 0===e?void 0:e.nylas,autoReply:null===G||void 0===G||null===(n=G.business)||void 0===n?void 0:n.autoReply,style:z})},children:"Discard"}),(0,l.jsx)(_.Z,{className:"primary",disabled:!X.ui.canSave,onClick:ge,loading:V,children:"Save"})]})]})]}):(0,l.jsxs)(w.u,{title:"Auto-reply",open:P,contentClassName:"w-full",buttons:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(_.Z,{className:"light",onClick:function(){var e,n;$({type:"RESET_STATE",nylas:null===G||void 0===G||null===(e=G.business)||void 0===e?void 0:e.nylas,autoReply:null===G||void 0===G||null===(n=G.business)||void 0===n?void 0:n.autoReply,style:z}),Y(!1)},children:"Cancel"}),"\xa0",ve?(0,l.jsx)(_.Z,{className:"primary",loading:V,disabled:!X.ui.canSave,onClick:ge,loadingText:"Saving",children:"Enable"}):(0,l.jsx)(v(),{href:"/upgrade?referer=/crm/contacts",children:(0,l.jsx)("a",{className:"button primary",children:"View plans"})})]}),setOpen:Y,children:[(0,l.jsx)("p",{className:"text-gray-900",children:"Automatically respond to website leads."}),q(ue)]})}},53006:function(e,n,t){t.d(n,{Z:function(){return b}});var i=t(26042),a=t(29815),o=t(11215),r=t(52699),l=t(31488),s=t(92265),u=t(47568),c=t(82222),d=t(97582),v=t(3732),p=t(67294),f=t(74906);function m(e){var n=e.prompt,t=e.data,i=e.outputLanguage,a=e.authenticated,o=void 0===a||a,r=e.onDone,l=void 0===r?function(){}:r,s=e.onContent,m=void 0===s?function(){}:s,g=e.onError,b=void 0===g?function(){}:g,y=e.endOfContentRef,h=e.previewRef,x=(0,p.useState)(""),j=x[0],Z=x[1],T=(0,p.useState)(!1),E=T[0],N=T[1],S=(0,p.useRef)([]),C=o?"/ai/generate":"/ai/generate-public",_=(0,f.Z)().stream,R=(0,p.useRef)(null);function w(){return(w=(0,u.Z)((function(){return(0,d.__generator)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,_(C,{prompt:n,data:t,output_language:i||"en"},(function(e){S.current.push(e)}),!0,R.current)];case 1:return e.sent(),[3,3];case 2:return e.sent(),S.current.push("[ERROR]"),[3,3];case 3:return[2]}}))}))).apply(this,arguments)}function O(){return(O=(0,u.Z)((function(){var e,n;return(0,d.__generator)(this,(function(t){switch(t.label){case 0:e=function(){var e,n;return(0,d.__generator)(this,(function(t){switch(t.label){case 0:return 0!==S.current.length?[3,2]:[4,(0,v._v)(100)];case 1:return t.sent(),[2,"continue"];case 2:switch(e=S.current.shift()){case"[ABORT]":return[3,3];case"[DONE]":return[3,4];case"[ERROR]":return[3,5]}return[3,6];case 3:return N(!1),[2,{v:void 0}];case 4:return N(!1),(null===h||void 0===h?void 0:h.current)&&h.current.scrollIntoView({behavior:"smooth"}),R.current=null,n=j,Z((function(e){return n=e,e})),l(n),[2,{v:void 0}];case 5:return N(!1),R.current=null,b(),[2,{v:void 0}];case 6:return Z((function(n){return n+e})),m(e),(null===y||void 0===y?void 0:y.current)&&y.current.scrollIntoView({behavior:"auto",block:"end"}),[4,(0,v._v)(5)];case 7:t.sent(),t.label=8;case 8:return[2]}}))},N(!0),t.label=1;case 1:return[5,(0,d.__values)(e())];case 2:return n=t.sent(),"object"===(0,c.Z)(n)?[2,n.v]:[3,1];case 3:return[2]}}))}))).apply(this,arguments)}return(0,p.useEffect)((function(){n&&(R.current&&(R.current.abort(),S.current.push("[ABORT]")),R.current=new AbortController,Z(""),function(){w.apply(this,arguments)}(),function(){O.apply(this,arguments)}())}),[n]),[j,Z,E]}var g=t(72521);function b(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.prompt,u=n.data,c=n.onDone,d=void 0===c?function(){}:c,v=n.onContent,p=void 0===v?function(){}:v,f=n.onError,b=void 0===f?function(){}:f,y=n.endOfContentRef,h=n.previewRef,x=n.applyWritingStyle,j=void 0===x||x,Z=n.voiceAndTone,T=(0,o.Z)(),E=T.current,N=(0,r.Z)().getAddressFromConfig,S=(0,s.Z)().aiSettingsRef,C=S.current,_=(null===C||void 0===C?void 0:C.voiceAndTone)||"professional",R=null===C||void 0===C?void 0:C.description,w=Array.isArray(null===C||void 0===C?void 0:C.services)?null===C||void 0===C||null===(e=C.services)||void 0===e?void 0:e.join(", "):null===C||void 0===C?void 0:C.services,O=null===E||void 0===E?void 0:E.name,k=(0,g.x)(E),A=N(),I=(null===C||void 0===C?void 0:C.language)||"en";return(0,a.Z)(m({prompt:t,data:(0,i.Z)({},(0,l.ZP)(j?null!==Z&&void 0!==Z?Z:_:null,k,O,A,R,w),u),outputLanguage:I,authenticated:!0,onDone:d,onContent:p,onError:b,endOfContentRef:y,previewRef:h})).concat([null!==Z&&void 0!==Z?Z:_])}}}]);