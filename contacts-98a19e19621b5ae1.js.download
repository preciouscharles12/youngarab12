(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[341],{18506:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/crm/contacts",function(){return n(62984)}])},64955:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(85893);n(67294);function r(e){var t=e.text,n=e.className,r=void 0===n?"":n,s=e.color,i=void 0===s?"blue":s,o=e.display,l=void 0===o?"inline-block":o,c=e.withDot,u=void 0!==c&&c;return t?(0,a.jsxs)("div",{className:"".concat(l," badge bg-").concat(i,"-100 ").concat(r),children:[u&&(0,a.jsx)("span",{className:"badge bg-".concat(i,"-400")}),(0,a.jsx)("span",{className:"text-".concat(i,"-800"),children:t})]}):null}},46284:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var a=n(85893),r=n(51523),s=n(67294),i=n(3732),o=n(66261),l=n(66605);function c(e){var t=e.text,n=e.children,c=e.className,u=e.alwaysShowIcon,d=void 0!==u&&u,m=e.positionRelative,f=void 0===m||m,p=e.showCopiedText,h=void 0===p||p,g=(0,r.Z)(t||n),v=g.copied,x=g.copy,y=g.reset,Z=function(e){e.stopPropagation(),x()};return(0,s.useEffect)((function(){var e=setTimeout((function(){y()}),2e3);return function(){clearTimeout(e)}}),[v]),(0,a.jsxs)("div",{className:(0,i.AK)("inline-flex items-center group",c,f&&"relative"),children:[n,v?(0,a.jsxs)("div",{className:(0,i.AK)("ml-1 text-green-500 transition-opacity",!d&&"group-hover:opacity-100 opacity-0",h&&"flex items-center absolute -right-5"),children:[(0,a.jsx)(o.Z,{icon:"CheckIcon",className:"w-5 h-5"}),h&&(0,a.jsx)("div",{className:"absolute left-5",children:"Copied"})]}):(0,a.jsx)(l.Z,{alt:(0,a.jsxs)("span",{onClick:Z,children:["Copy ",t]}),children:(0,a.jsx)(o.Z,{icon:"DocumentDuplicateSolidIcon",onClick:Z,className:(0,i.AK)("w-5 h-5 ml-1 transition-opacity text-indigo-600 hover:!opacity-70 cursor-pointer",!d&&"group-hover:opacity-100 opacity-0")})})]})}},5625:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(85893),r=n(3732),s=n(66261),i=n(16494),o=n(52077);function l(e){var t=e.className,n=e.page,l=e.setPage,c=e.results,u=e.loading;return(0,a.jsx)("div",{className:(0,r.AK)("sticky -bottom-24 table w-full",t),children:(0,a.jsx)("div",{className:"bg-white border-t rounded-b-lg px-4 py-3 flex items-center justify-between","aria-label":"Pagination",children:(0,a.jsxs)("div",{className:"flex-1 flex items-center justify-between space-x-2 w-full",children:[c.perPage<c.total&&(0,a.jsx)(a.Fragment,{children:n>1&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.Z,{onClick:function(){return l(1)},className:"light icon sm",disabled:n<=1||u,loading:u,children:(0,a.jsx)(s.Z,{icon:"ChevronDoubleLeftIcon",className:"w-4 h-4"})}),(0,a.jsx)(o.Z,{onClick:function(){return l(n-1)},className:"light icon sm",disabled:n<=1||u,loading:u,children:(0,a.jsx)(s.Z,{icon:"ChevronLeftIcon",className:"w-4 h-4"})})]})}),(0,a.jsxs)("p",{className:"sm:hidden text-sm text-gray-700",children:[(0,a.jsx)("span",{className:"font-medium",children:Math.min(c.page*c.perPage,c.total)})," ","of"," ",(0,a.jsx)("span",{className:"font-medium",children:c.total})]}),(0,a.jsx)("div",{className:"hidden sm:block",children:(0,a.jsx)("div",{className:"text-sm text-gray-700",children:u?(0,a.jsx)(i.Z,{text:"Loading..."}):(0,a.jsxs)("span",{children:["Showing ",(0,a.jsx)("span",{className:"font-medium",children:Math.min((c.page-1)*c.perPage+1,c.total)})," to ",(0,a.jsx)("span",{className:"font-medium",children:Math.min(c.page*c.perPage,c.total)})," of"," ",(0,a.jsx)("span",{className:"font-medium",children:c.total})," results"]})})}),c.perPage<c.total&&(0,a.jsx)(a.Fragment,{children:n<c.totalPages&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.Z,{onClick:function(){return l(n+1)},className:"light icon sm",disabled:n>=c.totalPages||u,loading:u,children:(0,a.jsx)(s.Z,{icon:"ChevronRightIcon",className:"w-4 h-4"})}),(0,a.jsx)(o.Z,{onClick:function(){return l(c.totalPages)},className:"light icon sm",disabled:n>=c.totalPages||u,loading:u,children:(0,a.jsx)(s.Z,{icon:"ChevronDoubleRightIcon",className:"w-4 h-4"})})]})})]})})})}},74274:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var a=n(26042),r=n(69396),s=n(85893),i=n(67294),o=n(46440),l=n(86215),c=n(2740),u=n(11355),d=n(3732),m=n(66261);function f(e){var t=e.className,n=e.icon,f=e.iconFrom,p=e.button,h=e.buttonClassName,g=e.openClassName,v=e.panelClassName,x=e.children,y=e.inline,Z=(0,i.useRef)(null),C=(0,i.useState)(null),b=C[0],E=C[1],N=(0,i.useState)(null),w=N[0],j=N[1],_=(0,o.D)(b,w,{placement:"bottom-end",modifiers:[{name:"flip",options:{allowedAutoPlacements:["top-end","bottom-end"]}},{name:"offset",options:{offset:[0,8]}}]}),S=_.styles,T=_.attributes,A=function(e){window.top.dispatchEvent(new CustomEvent("close-dropdown"))};return(0,s.jsx)(l.J,{className:(0,d.AK)("relative text-left",t),children:function(e){var t=e.open;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.J.Button,{ref:E,className:(0,d.AK)(h,t?g:"","cursor-pointer"),onClick:A,children:p||(0,s.jsx)(m.Z,{icon:n||"DotsVerticalIcon",from:f,className:(0,d.AK)("h-5 w-5",t?"text-indigo-500":"text-gray-700")})}),(0,s.jsx)(c.h,{children:(0,s.jsx)("div",(0,r.Z)((0,a.Z)({className:"z-100",ref:Z,style:S.popper},T.popper),{children:(0,s.jsx)(u.u,{show:t,as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",beforeEnter:function(){return j(Z.current)},afterLeave:function(){return j(null)},children:(0,s.jsx)(l.J.Panel,{static:!0,className:(0,d.AK)(y?"static":"absolute","origin-top-right right-0 mt-1 w-full min-w-60 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none",v),children:x})})}))})]})}})}},33253:function(e,t,n){"use strict";var a=n(29815),r=n(85893),s=n(67294),i=n(3732),o=n(66261);t.Z=function(e){var t=e.rating,n=e.setRating,l=e.readOnly,c=e.className,u=e.starClassName,d=e.allowHalfRating,m=(0,s.useState)(0),f=m[0],p=m[1];return(0,s.useEffect)((function(){l||f===t||p(t)}),[t]),(0,r.jsx)("div",{className:(0,i.AK)("star-rating flex",c),children:(0,a.Z)(Array(5)).map((function(e,a){return a+=1,(0,r.jsxs)("div",{className:"relative flex",children:[(0,r.jsx)("button",{type:"button",className:(0,i.AK)(a<=(!l&&f||t)?"text-yellow-400":"text-gray-200",l&&"cursor-default"),onClick:function(){return n(t===a?0:a)},onMouseEnter:function(){l||p(a)},onMouseLeave:function(){l||p(t)},disabled:l,children:(0,r.jsx)("div",{className:(0,i.AK)(u,"relative w-5 h-5"),children:(0,r.jsx)(o.Z,{icon:"StarSolidIcon",className:(0,i.AK)("absolute w-full h-full top-0 left-0")})})}),d&&(0,r.jsx)("button",{type:"button",className:(0,i.AK)("absolute top-0 left-0 w-1/2 overflow-hidden",a-.5<=(!l&&f||t)?"text-yellow-400":"text-gray-200",l&&"cursor-default"),onClick:function(){return n(t===a?.5:a-.5)},onMouseEnter:function(){l||p(a-.5)},onMouseLeave:function(){l||p(t-.5)},disabled:l,children:(0,r.jsx)("div",{className:(0,i.AK)(u,"relative w-5 h-5 overflow-hidden"),children:(0,r.jsx)(o.Z,{icon:"StarSolidIcon",className:(0,i.AK)("absolute w-full h-full top-0 left-0")})})})]},"star-".concat(a))}))})}},24903:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(85893),r=(n(67294),n(3732)),s={small:{wrapper:"8",innerWidth:"8",innerHeight:"3",textSize:""},medium:{wrapper:"16",innerWidth:"16",innerHeight:"3",textSize:"text-2xl"},large:{wrapper:"24",innerWidth:"24",innerHeight:"3",textSize:"text-4xl"}};function i(e){var t=s[e].wrapper;return"w-".concat(t," h-").concat(t)}function o(e){var t=s[e];return"w-".concat(t.innerWidth," h-").concat(t.innerHeight)}function l(e){var t,n,l=e.contact,c=e.size,u=void 0===c?"small":c,d=e.backgroundColor,m=void 0===d?"gray-500":d;if(!l)return null;var f=(null===(t=l.firstName)||void 0===t?void 0:t.charAt(0))||"",p=(null===(n=l.lastName)||void 0===n?void 0:n.charAt(0))||"";return(0,a.jsx)("div",{className:(0,r.AK)(i(u),"px-0.5 py-1.5 bg-".concat(m," rounded-full justify-center items-center inline-flex")),children:(0,a.jsxs)("div",{className:(0,r.AK)(o(u),"text-center text-white  font-medium leading-3",s[u].textSize),children:[f,p]})})}},71848:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var a=n(85893),r=n(67294),s=n(66261),i=n(3732),o=n(51121),l=n(43490),c=n(89831),u=n(39057),d=n(33602),m=n(11163);function f(e){var t=e.placeholder,n=void 0===t?"Search for a contact":t,f=(0,r.useContext)(c.HX),p=f.filters,h=f.ui,g=(0,r.useContext)(d.q),v=(0,r.useRef)(null),x=(0,r.useRef)(null),y=(0,m.useRouter)();return(0,r.useEffect)((function(){var e,t,n;(null===y||void 0===y||null===(e=y.query)||void 0===e?void 0:e.focus)&&"search"===(null===y||void 0===y||null===(t=y.query)||void 0===t?void 0:t.focus)&&(null===(n=x.current)||void 0===n||n.focus(),y.push(y.pathname,void 0,{shallow:!0}));var a=function(e){v.current&&!v.current.contains(e.target)&&h.expandSearch&&g({type:"SET_EXPAND_SEARCH",data:{value:!1}})};return document.addEventListener("click",a,!0),function(){document.removeEventListener("click",a,!0)}})),(0,r.useEffect)((function(){var e;h.expandSearch&&(null===(e=x.current)||void 0===e||e.focus())}),[h.expandSearch]),(0,a.jsxs)("div",{ref:v,className:(0,i.AK)("flex flex-row gap-3 flex-nowrap ",h.expandSearch?"sm:max-md:min-w-full w-full":""),children:[(0,a.jsxs)("div",{className:"flex-initial relative flex-grow basis-full",onClick:function(){(0,i.tq)()&&g({type:"SET_EXPAND_SEARCH",data:{value:!0}})},children:[(0,a.jsx)("span",{className:"absolute top-1/2 z-10 pl-2.5 -translate-y-1/2",children:(0,a.jsx)(s.Z,{icon:"SearchIcon",className:"w-5 h-5"})}),(0,a.jsx)(o.Z,{className:(0,i.AK)(" md:w-full",h.expandSearch?"w-full":"w-10 h-10"),inputClassName:(0,i.AK)("md:!pl-9 ",h.expandSearch?"w-full !pl-9":"!pl-6 w-10 h-10"),flexWrapperClassName:(0,i.AK)(h.expandSearch?"":"w-10 h-10 md:w-full"),value:p.query,ref:x,onChange:function(e){return g({type:"SET_QUERY",data:{value:e}})},placeholder:(!(0,i.tq)()||h.expandSearch)&&n||"",autoFocus:h.expandSearch})]}),h.showExtended&&(0,a.jsxs)("label",{className:(0,i.AK)("flex items-center relative group"),children:[(0,a.jsx)("div",{className:"block absolute z-50 p-4 bg-white shadow-lg rounded-lg w-56 top-full transition-opacity pointer-events-none group-hover:opacity-100 opacity-0 border border-gray-100",children:"In addition to search for name, email and phone, search as well for address, notes, etc."}),(0,a.jsx)(l.Z,{enabled:p.extended,onChange:function(e){return g({type:"SET_EXTENDED_FILTER",data:{value:e}})},className:"mr-2"})," ","Extended search"," ",(0,a.jsx)(s.Z,{icon:"QuestionMarkCircleIcon",from:"heroicons",className:"w-5 h-5 ml-2 text-gray-400"})]}),h.expandSearch&&(0,a.jsx)("div",{className:"flex-shrink-0 md:hidden",children:(0,a.jsx)("button",{className:"light w-10 h-10 !p-0",onClick:function(){return g({type:"SET_EXPAND_SEARCH",data:{value:!1,clearFilter:!0}})},children:(0,a.jsx)(u.Z,{className:"w-5 h-5"})})})]})}},89831:function(e,t,n){"use strict";n.d(t,{AZ:function(){return s},HX:function(){return r},I1:function(){return o},eo:function(){return i}});var a=n(67294),r=(0,a.createContext)({}),s=(0,a.createContext)([]),i=(0,a.createContext)(null),o=(0,a.createContext)({})},8208:function(e,t,n){"use strict";var a=n(47568),r=n(26042),s=n(69396),i=n(97582),o=n(67294),l=n(4519),c=n(3732),u="business.config",d={isLoading:!1,error:null,config:{}};function m(e,t){var n=t.type,a=t.error,i=void 0===a?null:a,o=t.data,l=void 0===o?null:o,d=t.skipCache;switch(null===n||void 0===n?void 0:n.toUpperCase()){case"FETCH":return(0,s.Z)((0,r.Z)({},e),{isLoading:!0,error:i});case"FINISH":return l&&!d&&(0,c.Fs)(u,l),{isLoading:!1,error:i,config:l||{}};default:throw new Error("Unknown action ".concat(n))}}t.Z=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,o.useReducer)(m,e?d:(0,c.tl)(u)||d),n=t[0],f=t[1],p=(0,l.Z)().get;function h(){return g.apply(this,arguments)}function g(){return(g=(0,a.Z)((function(){var t,n;return(0,i.__generator)(this,(function(a){switch(a.label){case 0:f({type:"FETCH"}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,p("business/get-config")];case 2:return(t=a.sent())&&t.status&&t.content?(f({type:"FINISH",data:t.content,skipCache:e}),[2,t.content]):(f({type:"FINISH",error:"Failed to load business infomation, please try again",skipCache:e}),[3,4]);case 3:return n=a.sent(),console.error(n),f({type:"FINISH",error:n.messsage,skipCache:e}),[3,4];case 4:return[2]}}))}))).apply(this,arguments)}return(0,s.Z)((0,r.Z)({},n),{fetchConfig:(0,o.useCallback)(h,[p,e])})}},62984:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return De}});var a=n(47568),r=n(26042),s=n(69396),i=n(10253),o=n(51351),l=n(97582),c=n(85893),u=n(67294),d=n(33299),m=n(11163),f=n(41664),p=n.n(f),h=n(61437),g=n(43714),v=n(53371),x=n(25675),y=n.n(x),Z=n(52077),C={active:{button:"bg-green-100 hover:bg-green-200",dot:"bg-green-400"},invactive:{button:"bg-gray-200 hover:bg-gray-300",dot:"bg-gray-400"}};function b(e){var t=e.isOn,n=t?C.active:C.invactive;return(0,c.jsxs)("div",{className:"text-label-sm ml-1 p-1 pr-2 rounded-3xl ".concat(n.button," inline-block px-3 pb-1 font-medium align-top mt-1 pr-3"),children:[(0,c.jsx)("div",{className:"mr-2 w-2 h-2 rounded-full ".concat(n.dot," inline-block")}),t?"On":"Off"]})}var E=n(66261),N=n(3732),w=120,j=295;function _(e){var t=e.title,n=e.subtitle,a=e.image,r=e.actionButtons,s=e.isPrimary,i=e.hasOnToggle,o=e.completed,l=void 0!==o&&o,u=e.completedText,d=void 0===u?"Enabled":u,f=e.loading,p=(0,m.useRouter)();return(0,c.jsxs)("div",{className:(0,N.AK)("mb-2 snap-always snap-center rounded-lg shadow dark:bg-gray-800 dark:border-gray-700 border-grey-200 flex-none w-[295px]",l?"bg-gray-100":"bg-white"),children:[(0,c.jsx)(y(),{src:"".concat((0,N.sd)("onboarding/crm/".concat(null===a||void 0===a?void 0:a.url))),alt:null===a||void 0===a?void 0:a.alt,height:w,width:j,className:(null===a||void 0===a?void 0:a.link)?"cursor-pointer rounded-t-lg":"rounded-t-lg",onClick:function(){(null===a||void 0===a?void 0:a.link)&&p.push(a.link)}}),(0,c.jsxs)("div",{className:"mx-4 my-4",children:[(0,c.jsxs)("h5",{className:"mb-1 font-bold text-gray-900",children:[t," ",i&&(0,c.jsx)(b,{isOn:l})]}),(0,c.jsx)("p",{className:"mb-3 font-normal text-gray-500",children:n}),l?(0,c.jsxs)("div",{className:"inline-block text-green-500",children:[(0,c.jsx)(E.Z,{icon:"CheckIcon",className:"w-5 h-5 bg-green-500 mr-2 rounded-full text-white mx-1 my-1 inline-block"}),d]}):Array.isArray(r)?(0,c.jsx)("div",{className:"flex flex-row gap-x-2 my-2",children:r.map((function(e,t){return(0,c.jsx)(Z.Z,{className:s&&!t?"primary":"light",loading:f,onClick:function(t){e.onClick&&e.onClick(t),"link"===e.type&&e.href&&p.push(e.href)},type:e.type,children:e.title},e.title)}))}):null]})]})}var S=n(70804);function T(e){var t=e.cards,n=e.title,i=e.showClose,o=void 0===i||i,d=e.onDismiss,m=e.loading,f=(0,u.useState)(!0),p=f[0],h=f[1];if(!Array.isArray(t)||t.length<1)return null;if(!t.find((function(e){return!e.completed}))||!p)return null;function g(){return(g=(0,a.Z)((function(){return(0,l.__generator)(this,(function(e){switch(e.label){case 0:return d?[4,d()]:[3,2];case 1:e.sent(),e.label=2;case 2:return h(!1),[2]}}))}))).apply(this,arguments)}return(0,c.jsxs)("div",{className:"my-2",children:[(0,c.jsxs)("div",{className:"flex gap-1 justify-between items-start",children:[(0,c.jsx)("p",{className:"text-2xl lg:text-h2 max-w-150 font-bold text-gray-900",children:n}),o&&(0,c.jsx)(E.Z,{icon:"XIcon",className:"flex-shrink-0 cursor-pointer",onClick:function(){return g.apply(this,arguments)}})]}),(0,c.jsx)(S.Z,{vertical:!1,className:"-ml-9 pl-9 md:-mr-9 md:-ml-12 md:pl-12 overflow-x-auto no-scrollbar",hideScrollbars:!1,children:(0,c.jsxs)("div",{className:"my-4 flex flex-nowrap gap-x-4 pl-1 z-20",children:[t.map((function(e,t){return(0,c.jsx)(_,(0,s.Z)((0,r.Z)({},e),{isPrimary:!t,loading:m}),e.id)})),(0,c.jsx)("div",{className:"block lg:min-w-5 "})]})})]})}var A=n(12280);function O(e){var t=e.open,n=e.setOpen;return(0,c.jsx)(A.u,{title:"CRM Tour",buttons:null,open:t,setOpen:n,fixedHeight:!1,footerHasMarginTop:!1,children:(0,c.jsx)("iframe",{src:"https://www.loom.com/embed/49e111ced82e4875b369b2e234d23ca6",width:"100%",height:"100%",frameBorder:"0",allow:"autoplay; fullscreen; picture-in-picture",className:"min-w-200 min-h-180"})})}var R=n(29815),k=n(44617),F=[{id:2,title:"Email Sync",subtitle:"Sync messages with your CRM",image:{url:"email-sync.svg",alt:"graphic of a table with a sync icon in the top right"},hasOnToggle:!0,completedText:"Enabled",actionButtons:[{title:"Enable email sync",type:"link",href:"?showEmailSyncModal=true"}],isCompleted:function(e){return(0,k.Fg)(e)}},{id:4,title:"Contact",subtitle:"Add a contact to your CRM",image:{url:"contact.svg",alt:"graphic of a web form with an icons of generic profile pictures and a group of people icon in the top right"},hasOnToggle:!1,completedText:"Added",actionButtons:[{title:"Add contact",type:"link",href:"?open=true"},{title:"Import",type:"link",href:"/crm/import"}],isCompleted:function(e,t,n){return!!n}},{id:5,title:"Website contact form",subtitle:"Add a contact form to get leads",image:{url:"contact-form.svg",alt:"graphic of a contact form with a funnel icon in the top right"},hasOnToggle:!1,completedText:"Added",actionButtons:[{title:(0,c.jsxs)(c.Fragment,{children:["Go to the website editor ",(0,c.jsx)(E.Z,{icon:"ArrowRightIcon",className:"ml-2 w-4 h-4"})]}),type:"link",href:"/website/builder"}],isCompleted:function(e){var t,n,a;return!!(null===e||void 0===e||null===(t=e.business)||void 0===t||null===(n=t.onboarding)||void 0===n||null===(a=n.crm)||void 0===a?void 0:a.hasContactForm)}}],D=[1,4,5,2,3];var I=n(4519),L=n(27818),P=n(36589);function M(e){var t,n,i,o,f=e.isFreePlan,p=e.config,h=e.getConfig,g=e.hasCustomers,v=e.loading,x=(0,m.useRouter)(),y=(0,I.Z)().patch,Z=(0,d.useSession)(),C=Z.update,b=Z.data,E=(0,u.useMemo)((function(){var e;return function(){var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=[],o=[];if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])for(var l=0;l<D.length;l++)for(var c=0;c<F.length;c++)D[l]==F[c].id&&o.push(F[c]);else o=(0,R.Z)(F);var u=[],d=!0,m=!1,f=void 0;try{for(var p,h=o[Symbol.iterator]();!(d=(p=h.next()).done);d=!0){var g=p.value,v=g.isCompleted&&g.isCompleted(n,t,a),x=(0,s.Z)((0,r.Z)({},g),{completed:v});delete x.isCompleted,Object.seal(x),v?u.push(x):i.push(x)}}catch(y){m=!0,f=y}finally{try{d||null==h.return||h.return()}finally{if(m)throw f}}return(e=i).push.apply(e,(0,R.Z)(u)),i}(f,null===b||void 0===b||null===(e=b.user)||void 0===e?void 0:e.onboarding,p,g)}),[f,p,null===b||void 0===b||null===(t=b.user)||void 0===t?void 0:t.onboarding,g]);if(null===b||void 0===b||null===(n=b.user)||void 0===n||null===(i=n.onboarding)||void 0===i||null===(o=i.crm)||void 0===o?void 0:o.onboardingDismissed)return null;var N=x.query,w=N.showOnboardingModal,j=N.showEmailSyncModal,_=N.showAutoReplyModal;function S(){return(S=(0,a.Z)((function(){var e;return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,y("/user/onboarding",{module:"crm",event:"videoComplete"})];case 1:return t.sent(),[3,3];case 2:return t.sent(),[3,3];case 3:return delete(e=(0,r.Z)({},x.query)).showOnboardingModal,x.push({query:e},void 0,{shallow:!0}),[2]}}))}))).apply(this,arguments)}function A(e){return k.apply(this,arguments)}function k(){return(k=(0,a.Z)((function(e){var t;return(0,l.__generator)(this,(function(n){return delete(t=(0,r.Z)({},x.query))[e],x.push({query:t},void 0,{shallow:!0}),[2]}))}))).apply(this,arguments)}var M=null;function q(){return(q=(0,a.Z)((function(){return(0,l.__generator)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,y("/user/onboarding",{module:"crm",event:"onboardingDismissed"})];case 1:return e.sent(),setTimeout((0,a.Z)((function(){return(0,l.__generator)(this,(function(e){switch(e.label){case 0:return[4,C((0,s.Z)((0,r.Z)({},b),{user:(0,s.Z)((0,r.Z)({},b.user),{onboarding:(0,s.Z)((0,r.Z)({},b.user.onboarding),{crm:(0,s.Z)((0,r.Z)({},b.user.onboarding.crm),{onboardingDismissed:!0})})})}))];case 1:return e.sent(),[2]}}))})),100),[3,3];case 2:return e.sent(),[3,3];case 3:return[2]}}))}))).apply(this,arguments)}return"true"===w?M="learn":"true"===j?M="connect":"true"===_&&(M="reply"),(0,c.jsxs)(c.Fragment,{children:[!v&&(0,c.jsx)(T,{cards:E,showClose:g,title:"Keep track of all your customers in one place",onDismiss:function(){return q.apply(this,arguments)},loading:v}),(0,c.jsx)(O,{open:"learn"===M,setOpen:function(){return S.apply(this,arguments)}}),(0,c.jsx)(L.Z,{config:p,style:"modal",modalOpen:"connect"===M,setModalOpen:function(){return A("showEmailSyncModal")}}),(0,c.jsx)(P.Z,{getConfig:h,config:p,style:"modal",modalOpen:"reply"===M,setModalOpen:function(){return A("showAutoReplyModal")}})]})}var q=n(89831),U=n(51121),H=n(30120),K=n(33253),B=n(46284),z=n(24903),W=n(11155),G=n(64955),X=[{name:"Name",field:"firstName",sortable:!0,formatter:function(e,t){return(0,c.jsxs)("span",{className:"inline-block",children:[(0,c.jsx)(z.Z,{contact:t}),(0,c.jsxs)("span",{className:"ml-2",children:[t.firstName||""," ",t.lastName||""]}),t.isSample&&(0,c.jsx)(G.Z,{color:"gray",className:"ml-2",text:"Sample"})]})}},{name:"Email",field:"email",sortable:!0,formatter:function(e){return(0,c.jsx)(B.Z,{text:e,className:"z-0 static",positionRelative:!1,children:e})}},{name:"New messages",field:"totalUnreadCombined",sortable:!0,formatter:function(e){return e?(0,c.jsxs)("span",{className:"inline-block text-indigo-600",children:[(0,c.jsx)(W.Z,{className:"w-5 h-5 inline-block"}),(0,c.jsx)("span",{className:"ml-2",children:e})]}):null}}],V=[{name:"Phone",field:"phone",sortable:!0,formatter:function(e){return(0,c.jsx)(p(),{href:"tel:".concat(e),children:(0,c.jsx)("a",{className:"link w-auto",onClick:function(e){return e.stopPropagation()},children:e})})}},{name:"Created",field:"createdAt",sortable:!0,type:"date",formatter:function(e){return H.ou.fromISO(e).toFormat("DD @ HH:mm")}},{name:"Company",field:"company",sortable:!0},{name:"Feedback",field:"feedback",sortable:!0,formatter:function(e,t){return(0,c.jsx)(K.Z,{rating:t.rating,readOnly:!0})}},{name:"Address",field:"address",sortable:!0,formatter:function(e,t){var n=t.address;return n?(0,c.jsxs)("p",{className:"flex gap-1 flex-wrap text-xs text-gray-500",children:[(0,c.jsx)("span",{children:n.line1||""}),(0,c.jsx)("span",{children:n.line2||""}),(0,c.jsx)("span",{children:n.city||n.state||n.country?(n.city?n.city:"")+(n.state?(n.city?" - ":"")+n.state:"")+(n.country?(n.state||n.city?" - ":"")+n.country:""):""}),(0,c.jsx)("span",{children:n.postalCode||""})]}):null}},{name:"Last Lead",field:"lastMessage.createdAt",sortable:!0,formatter:function(e,t){var n;if((null===t||void 0===t||null===(n=t.messages)||void 0===n?void 0:n.length)<1)return null;var a=t.messages.sort((function(e,t){return new Date(t.createdAt)-new Date(e.createdAt)}))[0];return(null===a||void 0===a?void 0:a.createdAt)?H.ou.fromISO(a.createdAt).toFormat("DD @ HH:mm"):""}}],Y=n(74274),Q=n(33602);function J(e){switch(e){case"number":return"HashtagIcon";case"money":return"CurrencyDollarIcon";case"date":return"CalendarIcon";case"checkbox":return"CheckCircleIcon";case"dropdown":return"ViewListIcon";case"rating":return"StarIcon";default:return"AnnotationIcon"}}function $(){var e=(0,u.useContext)(q.AZ),t=e.ui,n=e.customFields,a=(0,u.useContext)(Q.q),r=(0,R.Z)(V).concat((0,R.Z)(n));return(0,c.jsxs)(Y.Z,{className:"inline-block z-10",icon:"Cog8ToothIcon",buttonClassName:"button round hover:bg-indigo-50",openClassName:"bg-indigo-50",iconFrom:"heroicons",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"px-3 pt-4 pb-2 text-xs font-medium text-gray-500",children:"Visible columns"}),t.userColumns.map((function(e){var t=r.find((function(t){var n=t.field,a=t._id;return n===e||a===e}));return t?(0,c.jsxs)("div",{className:"group flex items-center justify-between gap-4 py-2 px-3 hover:bg-gray-50 transition-all cursor-pointer",onClick:function(){return a({type:"REMOVE_COLUMN",data:t._id||t.field})},children:[(0,c.jsxs)("p",{className:"inline-flex items-center gap-2 text-sm leading-5 font-medium text-gray-800 capitalize",children:[t.type&&(0,c.jsx)(E.Z,{icon:J(t.type),className:"flex-none w-4 h-4 text-gray-500"}),t.name]}),(0,c.jsx)("div",{className:"flex gap-2",children:(0,c.jsx)(E.Z,{icon:"CheckIcon",className:"h-4 w-4 text-indigo-600"})})]},t._id||t.field):null}))]}),(0,c.jsx)("hr",{className:"my-4"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"px-3 pb-2 text-xs font-medium text-gray-500",children:"Available columns"}),r.filter((function(e){var n=e.field,a=e._id;return!t.userColumns.includes(n)&&!t.userColumns.includes(a)})).map((function(e){return(0,c.jsx)("div",{className:"group flex items-center justify-between gap-2 py-2 px-3 hover:bg-gray-50 transition-all cursor-pointer",onClick:function(){return a({type:"ADD_COLUMN",data:e._id||e.field})},children:(0,c.jsxs)("p",{className:"inline-flex items-center gap-2 text-sm leading-5 font-medium text-gray-800 capitalize",children:[e.type&&(0,c.jsx)(E.Z,{icon:J(e.type),className:"flex-none w-4 h-4 text-gray-500"}),e.name]})},e._id||e.field)}))]})]})}var ee="top-0",te="".concat(ee," rounded-t-lg px-2 text-left text-sm font-semibold bg-gray-50");function ne(e){var t=e.field,n=e.title,a=e.isActiveSort,r=e.sortOrder,s=e.sortable,i=e.sortBy,o=(0,u.useContext)(Q.q);return(0,c.jsx)("th",{scope:"col",className:(0,N.AK)("py-4 md:px-6",te,"firstName"===t&&"left-10 z-20"),onClick:s?function(){return o({type:"SET_SORT_BY",data:{sortBy:i}})}:null,children:s?(0,c.jsxs)("div",{className:"group flex items-center gap-2 cursor-pointer min-w-[65px]",children:[(0,c.jsx)("span",{className:"md:whitespace-nowrap",children:n}),a?(0,c.jsx)(E.Z,{icon:r>0?"ChevronUpIcon":"ChevronDownIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0"}):(0,c.jsx)(E.Z,{icon:"SelectorIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})]}):(0,c.jsx)("div",{className:"flex items-center gap-2",children:(0,c.jsx)("span",{className:"md:whitespace-nowrap",children:n})})})}function ae(){var e=(0,u.useContext)(Q.q),t=(0,u.useContext)(q.HX).filters,n=(0,u.useContext)(q.AZ),a=n.ui,r=n.selectedContacts,s=n.contacts,i=n.customFields,o=t.sortBy,l=t.order,d=r.length===s.length&&s.length>0;return(0,c.jsx)("thead",{className:"bg-gray-50 pt-10",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:(0,N.AK)("sticky left-0 z-5 pr-1",te,ee),children:(0,c.jsx)(U.Z,{className:"ml-2",type:"checkbox",checked:d,onChange:function(t,n){var a=n.target;return e({type:"SET_SELECT_ALL",data:{value:a.checked}})}})}),X.map((function(e){var t=e.name,n=e.field,a=e.sortable;return(0,c.jsx)(ne,{field:n,title:t,isActiveSort:o===n,sortOrder:l,sortable:a,sortBy:n},n)})),a.userColumns.map((function(e){var t=V.find((function(t){return t.field===e}));if(!t&&i.length>0&&(t=i.find((function(t){return t._id===e}))),!t)return null;var n=t.name,a=t.field,r=t.sortable;return(0,c.jsx)(ne,{field:a,title:n,isActiveSort:o===(null===t||void 0===t?void 0:t._id)||o===a,sortOrder:l,sortable:r||!!(null===t||void 0===t?void 0:t._id),sortBy:(null===t||void 0===t?void 0:t._id)||a},t._id||a)})),(0,c.jsx)("th",{scope:"col",className:"md:table-cell md:px-6 py-3 text-right sticky right-0 ".concat(ee," bg-gradient-to-l font-bold from-gray-50 bg-gray-50 rounded-tr-lg z-5"),children:(0,c.jsx)($,{})})]})})}var re=n(76078),se=n(72510);function ie(e,t){switch(e.type){case"money":return(0,N.$K)(t)&&(0,c.jsxs)(c.Fragment,{children:["$",Number(t).toFixed(2)]});case"rating":return(0,c.jsx)(K.Z,{rating:t,readOnly:!0});case"date":return t&&H.ou.fromISO(t).toFormat("DD");case"dropdown":var n=e.options.find((function(e){return e.id===t}));return n?(null===n||void 0===n?void 0:n.color)?(0,c.jsx)(G.Z,{text:null===n||void 0===n?void 0:n.name,color:n.color,className:"pl-2"}):null===n||void 0===n?void 0:n.name:null;case"checkbox":return null===t||void 0===t?void 0:t.map((function(t){var n;return null===(n=e.options.find((function(e){return e.id===t})))||void 0===n?void 0:n.name})).join(", ");default:return t}}function oe(e){var t,n,a=e.field,r=null===(n=null===(t=e.contact.customFields)||void 0===t?void 0:t.find((function(e){return e.Field===a._id})))||void 0===n?void 0:n.value;return(0,c.jsx)("td",{className:"lg:table-cell px-6 py-4 whitespace-nowrap text-sm",children:ie(a,r)})}var le="bg-white",ce="bg-gray-50";function ue(e){var t=e.contact,n=(0,m.useRouter)(),a=(0,u.useContext)(Q.q),r=(0,u.useState)(!1),s=r[0],i=r[1],o=(0,u.useContext)(q.AZ),l=o.selectedContacts,d=o.ui,f=o.customFields;return(0,c.jsxs)("tr",{className:"cursor-pointer group w-full hover:bg-gray-50",onMouseEnter:function(){return i(!0)},onMouseLeave:function(){return i(!1)},children:[(0,c.jsx)("td",{className:(0,N.AK)("sticky left-0 z-5",s?ce:le),children:(0,c.jsx)(U.Z,{className:"ml-4 pr-2",flexWrapperClassName:"static",type:"checkbox",checked:l.includes(t._id),onChange:function(e,n){a({type:"SET_CONTACT_SELECTED",data:{selected:n.target.checked,id:t._id}})}})}),X.map((function(e){var a=e.field,r=e.formatter,i=t[a];return(0,c.jsx)("td",{className:(0,N.AK)("px-2 md:px-6 py-4 whitespace-nowrap text-sm","firstName"===a&&"font-medium",s?ce:le),onClick:function(){return n.push("/crm/".concat(t._id))},children:r?r(i,t):i},a)})),d.userColumns.map((function(e){var a=V.find((function(t){return t.field===e}));if(!a&&f.length>0&&(a=f.find((function(t){return t._id===e}))),!a)return null;var r=a.field,s=a.formatter,i=t[r];return a._id?(0,c.jsx)(oe,{field:a,contact:t},a._id):(0,c.jsx)("td",{className:"px-2 md:px-6 py-4 whitespace-nowrap text-sm",onClick:function(){return n.push("/crm/".concat(t._id))},children:s?s(i,t):i},(null===a||void 0===a?void 0:a._id)||r)})),(0,c.jsx)("td",{className:" md:px-6 py-3 text-right sticky right-0 bg-gradient-to-l from-white text-sm font-medium space-x-3 items-center align-middle bg-white bg-opacity-80 group-hover:bg-gray-50 group-hover:bg-opacity-80",children:(0,c.jsxs)(re.Z,{inline:!0,buttonClassName:"button round hover:bg-indigo-50",openClassName:"bg-indigo-50 z-10",children:[(0,c.jsx)(se.v.Item,{as:"div",children:(0,c.jsx)(p(),{href:"/invoices/create?contact=".concat(t._id),children:(0,c.jsx)("a",{className:"block px-4 py-2.5 hover:bg-gray-100 text-gray-700",onClick:function(e){return e.stopPropagation()},children:"Invoice"})})}),(0,c.jsx)(se.v.Item,{as:"div",children:(0,c.jsx)(p(),{href:"/crm/".concat(t._id,"?open=compose"),children:(0,c.jsx)("a",{className:"block px-4 py-2.5 hover:bg-gray-100 text-gray-700",onClick:function(e){return e.stopPropagation()},children:"Email"})})}),(0,c.jsx)(se.v.Item,{as:"div",children:(0,c.jsx)("div",{onClick:function(e){e.stopPropagation(),a({type:"REQUEST_CONTACT_REVIEW",data:{contact:t}})},className:"block px-4 py-2.5 hover:bg-gray-100 text-gray-700 cursor-pointer",children:"Request review"})}),(0,c.jsx)(se.v.Item,{as:"div",children:(0,c.jsx)(p(),{href:"/crm/".concat(t._id),children:(0,c.jsx)("a",{className:"block px-4 py-2.5 hover:bg-gray-100 text-gray-700",onClick:function(e){return e.stopPropagation()},children:"Manage"})})}),(0,c.jsx)(se.v.Item,{as:"div",children:(0,c.jsx)("div",{className:"block px-4 py-2.5 hover:bg-red-100 text-red-700 cursor-pointer",onClick:function(e){e.stopPropagation(),a({type:"DELETE_CONTACT",data:{contact:t}})},children:"Delete"})})]})})]})}var de=n(16494),me=n(5625);function fe(e){var t=e.loading,n=e.totalCustomers,a=void 0===n?0:n,i=function(){var e=document.getElementById("table-footer");if(e){var t=e.getBoundingClientRect().bottom,n=window.innerHeight;l(t>=n)}},o=(0,u.useState)(!1),l=(o[0],o[1]),d=(0,u.useContext)(q.AZ),m=d.contacts,f=d.ui,p=(0,u.useContext)(Q.q),h=(0,u.useContext)(q.HX).filters;m.length,X.length,f.userColumns.length;return(0,u.useEffect)((function(){i()}),[t]),(0,u.useEffect)((function(){return window.addEventListener("scroll",i),function(){window.removeEventListener("scroll",i)}}),[]),(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("div",{className:"flex flex-col shadow rounded-lg mb-4 relative",children:!m.length&&t?(0,c.jsx)(de.Z,{variant:"table",className:"w-full"}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"overflow-x-auto min-h-20",children:(0,c.jsxs)("table",{className:"divide-y divide-gray-200 relative w-full",children:[(0,c.jsx)(ae,{}),(0,c.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map((function(e){return(0,c.jsx)(ue,{contact:e},e._id)}))})]})}),(0,c.jsx)(me.Z,{className:"z-10",page:h.page,results:(0,s.Z)((0,r.Z)({},h),{total:a,totalPages:Math.ceil(a/h.perPage)}),loading:t,setPage:function(e){return p({type:"SET_PAGE",data:{page:e}})}})]})})})}var pe=n(8208),he=n(60728),ge=n(86897),ve=n(7219),xe=n(86367),ye=n(78017);function Ze(e){var t=e.canAddCustomers,n=e.isFreePlan,a=e.isLoading,r=(0,u.useContext)(Q.q);return!t||n?(0,c.jsxs)(Z.Z,{className:"button light",disabled:a,onClick:function(){return r({type:"SET_PAYWALL",data:{context:"customers_import",open:!0}})},children:[(0,c.jsx)(ge.Z,{className:"h-4 w-4 mr-2"}),"Import"]}):(0,c.jsx)(p(),{href:"/crm/import",disabled:a,children:(0,c.jsxs)("a",{className:"button light",children:[(0,c.jsx)(ge.Z,{className:"h-4 w-4 mr-2"}),"Import"]})})}function Ce(e){var t=e.canAddCustomers,n=e.isLoading,a=e.onboardingCompleted,r=(0,u.useContext)(Q.q);return t?(0,c.jsx)(p(),{href:"?open=true",children:(0,c.jsxs)("a",{className:(0,N.AK)(a?"primary":"secondary","button"),disabled:n,children:[(0,c.jsx)(ve.Z,{className:"h-4 w-4 mr-2"}),"Add contact"]})}):(0,c.jsxs)(Z.Z,{className:"button primary",disabled:n,onClick:function(){return r({type:"SET_PAYWALL",data:{context:"customers",open:!0}})},children:[(0,c.jsx)(ve.Z,{className:"h-4 w-4 mr-2"}),"Add contact"]})}function be(e){var t=e.canAddCustomers,n=e.isFreePlan,s=e.isLoading,i=e.onboardingCompleted,o=(0,u.useContext)(Q.q),d=(0,u.useContext)(q.AZ).selectedContacts,m=(0,N.h_)(),f=(0,I.Z)().remove,h=(0,he.Z)(),g=h.confirm,v=h.ConfirmDialog;function x(){return(x=(0,a.Z)((function(){return(0,l.__generator)(this,(function(e){return g("Delete Contacts?",(0,c.jsxs)("span",{children:["Are you sure you want to delete ",d.length," contacts?"]}),(0,a.Z)((function(){var e,t;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,f("/customer/bulk/delete?ids=".concat(d.join(",")))];case 1:return(e=n.sent()).status?(o({type:"DELETE_BULK_SUCCESS",data:(0,r.Z)({},e.content)}),N.Z9.success("Contacts deleted successfully"),[3,3]):[2,o({type:"SET_ERROR",data:{value:"Failed to delete contacts ".concat(e.message)}})];case 2:return t=n.sent(),[2,o({type:"SET_ERROR",data:{value:"Failed to delete contacts ".concat(t.message)}})];case 3:return[2]}}))}))),[2]}))}))).apply(this,arguments)}return d.length>0?(0,c.jsxs)("div",{className:"items-center gap-3 flex",children:[(0,c.jsx)(p(),{href:"/api/crm/export?bid=".concat(m,"&ids=").concat(d.join(",")),passHref:!0,disabled:s,children:(0,c.jsxs)("a",{className:"button light",download:!0,children:[(0,c.jsx)(xe.Z,{className:"h-4 w-4 mr-2"}),"Export"]})}),(0,c.jsxs)(Z.Z,{className:"button danger",onClick:function(){return x.apply(this,arguments)},disabled:s,children:[(0,c.jsx)(ye.Z,{className:"h-4 w-4 mr-2"}),"Delete"]}),(0,c.jsx)(v,{attention:!0,confirmText:"Delete"})]}):(0,c.jsxs)("div",{className:"items-center gap-3 flex",children:[(0,c.jsx)(Ze,{canAddCustomers:t,isFreePlan:n,isLoading:s}),(0,c.jsx)(Ce,{onboardingCompleted:i,canAddCustomers:t,isLoading:s})]})}var Ee=n(71848),Ne=n(11671),we=n(43994),je={data:{config:{},customers:[],customFields:[],totalCustomers:0,userPlan:{},hasPlan:!1,isFreePlan:!1,hasCustomers:!1,hasCompletedOnboarding:!1,canAddCustomers:!1,filters:{page:1,perPage:20,query:"",extended:!1,sortBy:"createdAt",order:-1,type:null},selectedContacts:[],manageCustomer:{},manageField:null,emailSyncActive:!0},ui:{error:"",loading:!0,loadingConfig:!0,modal:null,manageCustomFieldsOpen:!1,manageFieldAction:null,paywall:{context:"customers",open:!1},table:{userColumns:[],selectedContacts:[]},filters:{expandSearch:!1,showExtended:!1}}};function _e(e){return!!Array.isArray(e)&&(!e.find((function(e){return e.isSample}))&&e.length>0)}function Se(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0,a=null===n||void 0===n||null===(e=n.limits)||void 0===e?void 0:e.customers;return-1===a&&(a=Number.MAX_SAFE_INTEGER),t<=a}function Te(e,t){var n,a,i;return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{userPlan:null===t||void 0===t?void 0:t.plan,hasPlan:(0,N.qE)(null===t||void 0===t?void 0:t.subscriptionStatus),isFreePlan:(0,N.H6)(null===t||void 0===t||null===(n=t.plan)||void 0===n?void 0:n.priceId),hasCompletedOnboarding:null===t||void 0===t||null===(a=t.onboarding)||void 0===a||null===(i=a.crm)||void 0===i?void 0:i.onboardingDismissed,canAddCustomers:Se(e.data.totalCustomers,null===t||void 0===t?void 0:t.plan)})})}function Ae(e,t){var n=t.type,a=t.data,i=void 0===a?{}:a;switch(null===n||void 0===n?void 0:n.toUpperCase()){case"SET_PAYWALL":return(0,s.Z)((0,r.Z)({},e),{ui:(0,s.Z)((0,r.Z)({},e.ui),{paywall:(0,r.Z)({},i)})});case"SET_CONFIG":var o,l,c,u,d,m;return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{config:i||{},emailSyncActive:!((null===i||void 0===i||null===(o=i.business)||void 0===o||null===(l=o.nylas)||void 0===l?void 0:l.invalid)||!(null===i||void 0===i||null===(c=i.business)||void 0===c||null===(u=c.nylas)||void 0===u?void 0:u.token))}),ui:(0,s.Z)((0,r.Z)({},e.ui),{loadingConfig:!1,table:(0,s.Z)((0,r.Z)({},e.ui.table),{userColumns:(0,R.Z)(new Set((0,R.Z)(null===i||void 0===i||null===(d=i.business)||void 0===d||null===(m=d.settings)||void 0===m?void 0:m.customerColumns)))})})});case"SET_CUSTOM_FIELDS":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{customFields:Array.isArray(i)?i:[]})});case"SET_LOADING":return(0,s.Z)((0,r.Z)({},e),{ui:(0,s.Z)((0,r.Z)({},e.ui),{loading:(null===i||void 0===i?void 0:i.value)||!1,error:null})});case"SET_PAYWALL_OPEN":return(0,s.Z)((0,r.Z)({},e),{ui:(0,s.Z)((0,r.Z)({},e.ui),{paywall:(0,s.Z)((0,r.Z)({},e.ui.paywall),{open:i.value||!1})})});case"SET_ERROR":var f;return(0,s.Z)((0,r.Z)({},e),{ui:(0,s.Z)((0,r.Z)({},e.ui),{error:(null===i||void 0===i||null===(f=i.value)||void 0===f?void 0:f.message)||(null===i||void 0===i?void 0:i.value)||"",loading:!1})});case"SET_SESSION_USER":return Te(e,i);case"SET_CUSTOMERS":var p,h,g=[],v=i.customers||[];if(1===i.page)(p=g).push.apply(p,(0,R.Z)(v));else(h=g).push.apply(h,(0,R.Z)(e.data.customers).concat((0,R.Z)(v)));return g=g.filter((function(e,t,n){return t===n.findIndex((function(t){return t._id===e._id}))})),(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{customers:g,totalCustomers:i.total||0,hasCustomers:_e(g),canAddCustomers:Se(i.total,e.data.userPlan),filters:(0,s.Z)((0,r.Z)({},e.data.filters),{page:i.page,perPage:i.perPage})}),ui:(0,s.Z)((0,r.Z)({},e.ui),{loading:!1})});case"SET_QUERY":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{filters:(0,s.Z)((0,r.Z)({},e.data.filters),{query:i.value||"",extended:!!i.value&&e.data.filters.extended,page:0})}),ui:(0,s.Z)((0,r.Z)({},e.ui),{filters:(0,s.Z)((0,r.Z)({},e.ui.filters),{showExtended:!!i.value})})});case"SET_PAGE":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{filters:(0,s.Z)((0,r.Z)({},e.data.filters),{page:i.page||1})}),ui:(0,s.Z)((0,r.Z)({},e.ui),{loading:!0})});case"SET_EXTENDED_FILTER":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{filters:(0,s.Z)((0,r.Z)({},e.data.filters),{extended:i.value||!1})})});case"SET_SORT_BY":var x=i.sortBy===e.data.filters.sortBy,y=e.data.filters.order,Z=e.data.customers;return y=x?-1===y?1:-1:"createdAt"===i.sortBy?-1:1,(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{customers:Z,filters:(0,s.Z)((0,r.Z)({},e.data.filters),{sortBy:i.sortBy,order:y,page:0})})});case"ADD_COLUMN":return(0,s.Z)((0,r.Z)({},e),{ui:(0,s.Z)((0,r.Z)({},e.ui),{table:(0,s.Z)((0,r.Z)({},e.ui.table),{userColumns:(0,R.Z)(new Set((0,R.Z)(e.ui.table.userColumns).concat([i])))})})});case"REMOVE_COLUMN":return(0,s.Z)((0,r.Z)({},e),{ui:(0,s.Z)((0,r.Z)({},e.ui),{table:(0,s.Z)((0,r.Z)({},e.ui.table),{userColumns:e.ui.table.userColumns.filter((function(e){return e!==i}))})})});case"SET_CONTACT_SELECTED":var C=[];return C=i.selected?(0,R.Z)(e.data.selectedContacts).concat([i.id]):e.data.selectedContacts.filter((function(e){return e!==i.id})),(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{selectedContacts:C})});case"SET_SELECT_ALL":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{selectedContacts:i.value?e.data.customers.map((function(e){return e._id})):[]})});case"SET_MODAL":return(0,s.Z)((0,r.Z)({},e),{ui:(0,s.Z)((0,r.Z)({},e.ui),{modal:i,manageCustomFieldsOpen:(null!==i||!e.ui.manageCustomFieldsOpen)&&e.ui.manageCustomFieldsOpen})});case"SET_MANAGE_CUSTOMER":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{manageCustomer:i.customer}),ui:(0,s.Z)((0,r.Z)({},e.ui),{modal:(0,N.nK)(i.customer)?null:e.ui.modal})});case"CUSTOMER_SAVED":var b=e.data.customers.filter((function(e){return e.isSample})),E=[i.customer].concat((0,R.Z)(e.data.customers.filter((function(e){return!e.isSample})))),w=e.data.totalCustomers+1-b.length;return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{manageCustomer:{},customers:E,totalCustomers:w,hasCustomers:!0,canAddCustomers:Se(w,e.data.userPlan)}),ui:(0,s.Z)((0,r.Z)({},e.ui),{loading:!1,modal:null})});case"CONTACT_DELETED_SUCCESS":var j=e.data.totalCustomers-1;return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{manageCustomer:{},customers:e.data.customers.filter((function(e){return e._id!==i.contact._id})),totalCustomers:j,hasCustomers:j>0,canAddCustomers:Se(j,e.data.userPlan),selectedContacts:e.data.selectedContacts.filter((function(e){return e!==i.contact._id}))}),ui:(0,s.Z)((0,r.Z)({},e.ui),{loading:!1,modal:null})});case"SET_EDIT_COLUMN":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{manageField:i.field}),ui:(0,s.Z)((0,r.Z)({},e.ui),{manageCustomFieldsOpen:!0,manageFieldAction:i.action})});case"SET_OPEN_ADD_FIELD":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{manageField:null}),ui:(0,s.Z)((0,r.Z)({},e.ui),{manageCustomFieldsOpen:!0,manageFieldAction:"add"})});case"DELETE_CONTACT":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{manageCustomer:i.contact}),ui:(0,s.Z)((0,r.Z)({},e.ui),{modal:"deleteContact"})});case"RESET_CONTACT_DELETE":case"RESET_CONTACT_REVIEW_REQUEST":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{manageCustomer:{}}),ui:(0,s.Z)((0,r.Z)({},e.ui),{modal:null})});case"REQUEST_CONTACT_REVIEW":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{manageCustomer:i.contact}),ui:(0,s.Z)((0,r.Z)({},e.ui),{modal:"requestReview"})});case"DELETE_BULK_SUCCESS":var _=e.data.totalCustomers-i.deletedCount,S=e.data.selectedContacts,T=e.data.filters.page-1;return 0===_&&(T=0),T<0&&(T=0),(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{customers:e.data.customers.filter((function(e){var t=e._id;return!S.includes(t)})),totalCustomers:_,hasCustomers:_>0,canAddCustomers:Se(_,e.data.userPlan),selectedContacts:[],filters:(0,s.Z)((0,r.Z)({},e.data.filters),{page:T})}),ui:(0,s.Z)((0,r.Z)({},e.ui),{loading:!1})});case"SET_EXPAND_SEARCH":return(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{filters:(0,s.Z)((0,r.Z)({},e.data.filters),{query:i.clearFilter?"":e.data.filters.query,extended:!i.clearFilter&&e.data.filters.extended})}),ui:(0,s.Z)((0,r.Z)({},e.ui),{filters:(0,s.Z)((0,r.Z)({},e.ui.filters),{expandSearch:i.value,showExtended:!1})})});case"SET_SHOW_MANAGE_CUSTOM_FIELDS":return!1===i?(0,s.Z)((0,r.Z)({},e),{ui:(0,s.Z)((0,r.Z)({},e.ui),{manageCustomFieldsOpen:!1})}):(0,s.Z)((0,r.Z)({},e),{data:(0,s.Z)((0,r.Z)({},e.data),{manageField:(null===i||void 0===i?void 0:i.field)||null}),ui:(0,s.Z)((0,r.Z)({},e.ui),{manageCustomFieldsOpen:!!i,manageFieldAction:(null===i||void 0===i?void 0:i.action)||null})});default:throw new Error("Unknown action ".concat(n))}}var Oe=n(5137),Re=n(93281),ke=null,Fe=null;function De(e){e=null!==e?e:(0,o.Z)(new TypeError("Cannot destructure undefined"));var t,n,f=(0,i.Z)((0,h.Z)("layout.title","CRM",!0),2),x=(f[0],f[1],(0,d.useSession)().data),y=(0,g.Z)().track,Z=(0,he.Z)(),C=Z.confirm,b=Z.ConfirmDialog,E=(0,he.Z)(),w=E.confirm,j=E.ConfirmDialog,_=(0,u.useReducer)(Ae,je,(function(e){return function(e,t){return Te(e,null===t||void 0===t?void 0:t.user)}(e,x)})),S=_[0],T=_[1];(0,Oe.Z)(S.ui.error);var A=(0,pe.Z)(),O=A.isLoading,R=A.fetchConfig,k=(0,I.Z)(),F=k.get,D=k.post,L=k.remove,P=((0,u.useMemo)((function(){return new Re.c(k)}),[k]),(0,m.useRouter)()),U=P.query.open;function H(){return(H=(0,a.Z)((function(e){var t;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,L("/customer/delete",{idCustomer:null===e||void 0===e?void 0:e._id}).catch((function(e){return T({type:"SET_ERROR",data:{value:e}})}))];case 1:return!0!==(null===(t=n.sent())||void 0===t?void 0:t.status)?(T({type:"SET_ERROR",data:{value:"Error deleting contact, please try again. ".concat(t.message)}}),[2]):(T({type:"CONTACT_DELETED_SUCCESS",data:{contact:e}}),N.Z9.success("Contact deleted!"),[2])}}))}))).apply(this,arguments)}function B(){return B=(0,a.Z)((function(e){var t,n;return(0,l.__generator)(this,(function(a){switch(a.label){case 0:return[4,D("/marketing/request-review",{idCustomer:e._id}).catch((function(e){return T({type:"SET_ERROR",data:{value:e}})}))];case 1:return(null===(t=a.sent())||void 0===t?void 0:t.status)?(N.Z9.success("Review requested!"),null===(n=e.reviewRequested)||void 0===n||n.push(DateTime.now().toISO())):T({type:"SET_ERROR",data:{value:"Error requesting the review, please try again. ".concat(t.message)}}),T({type:"RESET_CONTACT_REVIEW_REQUEST"}),[2]}}))})),B.apply(this,arguments)}function z(){return W.apply(this,arguments)}function W(){return(W=(0,a.Z)((function(){var e;return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return S.data.hasPlan?[4,F("/customer/get-by-filter",(0,s.Z)((0,r.Z)({},S.data.filters),{includeThreadCount:S.data.emailSyncActive}))]:[2,Promise.resolve({})];case 1:return(e=t.sent()).status?(T({type:"SET_LOADING",data:{value:!1}}),[2,e.content]):[2,Promise.reject(new Error("Failed to load contacts ".concat(e.message)))]}}))}))).apply(this,arguments)}function G(){return X.apply(this,arguments)}function X(){return(X=(0,a.Z)((function(){var e;return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return S.data.hasPlan?[4,F("/custom-field/get-by-category",{category:"customer"}).catch((function(e){return T({type:"SET_ERROR",data:{value:e}})}))]:[2,Promise.resolve({})];case 1:return!0===(null===(e=t.sent())||void 0===e?void 0:e.status)&&(null===e||void 0===e?void 0:e.content)?((0,N.Fs)("customer.custom-fields",e.content),[2,e.content]):[2]}}))}))).apply(this,arguments)}function V(){return(V=(0,a.Z)((function(e,t){var n;return(0,l.__generator)(this,(function(a){switch(a.label){case 0:return[4,D("/business/save-settings",{path:e,value:t})];case 1:return!0===(null===(n=a.sent())||void 0===n?void 0:n.status)&&n.content?((0,N.Fs)("business.settings",n.content),[2,n.content]):(T({type:"SET_ERROR",data:{value:"Error saving the business settings, please try again. ".concat(n.message)}}),[2])}}))}))).apply(this,arguments)}function Y(){return(Y=(0,a.Z)((function(e){var t;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return T({type:"SET_LOADING",data:{value:!0}}),[4,D(e._id?"/customer/edit":"/customer/create",e).catch((function(e){return T({type:"SET_ERROR",data:{value:e}})}))];case 1:return(null===(t=n.sent())||void 0===t?void 0:t.status)?(T({type:"CUSTOMER_SAVED",data:{customer:t.content}}),N.Z9.success("Contact saved!"),[2]):(T({type:"SET_ERROR",data:{value:"Error saving this contact, please try again. ".concat(t.message)}}),[2])}}))}))).apply(this,arguments)}return(0,u.useEffect)((function(){return T({type:"SET_LOADING",data:{value:O||!1}})}),[O]),(0,u.useEffect)((function(){return T({type:"SET_SESSION_USER",data:(0,r.Z)({},null===x||void 0===x?void 0:x.user)})}),[null===x||void 0===x?void 0:x.user]),(0,u.useEffect)((function(){T({type:"SET_MODAL",data:U?"manage":null})}),[U]),(0,u.useEffect)((function(){if(U&&!S.ui.modal){var e=(0,r.Z)({},P.query);delete e.open,P.push({query:e},void 0,{shallow:!0})}}),[S.ui.modal]),(0,u.useEffect)((function(){var e=S.data.manageCustomer;if("deleteContact"===S.ui.modal)C("Delete contact?","",(function(){return function(e){return H.apply(this,arguments)}(e)}),(function(){return T({type:"RESET_CONTACT_DELETE"})}));else if("requestReview"===S.ui.modal){var t,n,a,r,s=null===(t=S.data.config.business)||void 0===t||null===(n=t.marketing)||void 0===n?void 0:n.reviews,i=!(!(null===s||void 0===s||null===(a=s.template)||void 0===a?void 0:a.content)||!(null===s||void 0===s||null===(r=s.template)||void 0===r?void 0:r.title)),o=!!((null===s||void 0===s?void 0:s.enableGoogleReviews)&&(null===s||void 0===s?void 0:s.googleURL)||(null===s||void 0===s?void 0:s.enableFacebookReviews)&&(null===s||void 0===s?void 0:s.facebookURL));i&&o?w("Request a review from ".concat(e.firstName," ").concat(e.lastName?" ".concat(e.lastName):""),"",(function(){return function(e){return B.apply(this,arguments)}(e)}),(function(){return T({type:"RESET_CONTACT_REVIEW_REQUEST"})})):(P.push("/marketing/reviews"),N.Z9.info("Please setup your review template and review platforms to request a review."))}}),[S.ui.modal]),(0,u.useEffect)((function(){T({type:"SET_LOADING",data:{value:!0}}),Promise.all([R(),z(),G()]).then((function(e){var t=(0,i.Z)(e,3),n=t[0],a=t[1],r=t[2];T({type:"SET_CONFIG",data:n}),T({type:"SET_CUSTOMERS",data:a}),T({type:"SET_CUSTOM_FIELDS",data:r})})).catch((function(e){return T({type:"SET_ERROR",data:{value:e}})}))}),[]),(0,u.useEffect)((function(){return clearTimeout(ke),ke=setTimeout((function(){T({type:"SET_LOADING",data:{value:!0}}),z().then((function(e){T({type:"SET_CUSTOMERS",data:e})})).catch((function(e){return T({type:"SET_ERROR",data:{value:e}})}))}),400),function(){clearTimeout(ke)}}),[S.data.filters.query,S.data.filters.extended,S.data.filters.sortBy,S.data.filters.order,S.data.filters.page]),(0,u.useEffect)((function(){return clearTimeout(Fe),Fe=setTimeout((function(){(function(e,t){return V.apply(this,arguments)})("customerColumns",S.ui.table.userColumns).catch((function(e){return T({type:"SET_ERROR",data:{value:e}})}))}),400),function(){clearTimeout(Fe)}}),[S.ui.table.userColumns]),(0,u.useEffect)((function(){y("app:crm-viewed")}),[]),(0,c.jsxs)(Q.q.Provider,{value:T,children:[(0,c.jsx)(q.HX.Provider,{value:{filters:S.data.filters,ui:S.ui.filters},children:(0,c.jsx)(q.AZ.Provider,{value:{contacts:S.data.customers,customFields:S.data.customFields,selectedContacts:S.data.selectedContacts,ui:S.ui.table},children:(0,c.jsxs)("section",{children:[(0,c.jsx)(M,{isFreePlan:S.data.isFreePlan,config:S.data.config,hasCustomers:S.data.hasCustomers,getConfig:R,loading:S.ui.loadingConfig}),(0,c.jsxs)("div",{id:"controls",className:"bg-gray-50 flex items-center justify-between gap-3 z-10 pb-4",children:[(0,c.jsx)(Ee.Z,{hasCompletedOnboarding:S.data.hasCompletedOnboarding,canAddCustomers:S.data.canAddCustomers,isFreePlan:S.data.isFreePlan}),(S.data.hasCustomers||S.data.hasCompletedOnboarding)&&!S.ui.filters.expandSearch&&(0,c.jsx)(be,{onboardingCompleted:S.data.hasCompletedOnboarding,canAddCustomers:S.data.canAddCustomers,isFreePlan:S.data.isFreePlan,isLoading:S.ui.loading})]}),(0,c.jsx)(fe,{loading:S.ui.loading,totalCustomers:S.data.totalCustomers})]})})}),(0,c.jsx)(v.Z,{context:S.ui.paywall.context,open:S.ui.paywall.open,setOpen:function(e){return T({type:"SET_PAYWALL_OPEN",data:{value:e}})}}),(0,c.jsx)(Ne.y,{customer:S.data.manageCustomer,open:"manage"===S.ui.modal,setOpen:function(e){return!S.ui.manageCustomFieldsOpen&&T({type:"SET_MODAL",data:e?"manage":null})},loading:S.ui.loading,save:function(e){return Y.apply(this,arguments)},onManageCustomFields:function(e){return T({type:"SET_SHOW_MANAGE_CUSTOM_FIELDS",data:e})},customFields:S.data.customFields,manageCustomFieldsOpen:S.ui.manageCustomFieldsOpen}),(0,c.jsx)(we.w,{customFields:S.data.customFields,customFieldsLoading:S.ui.loading,field:S.data.manageField,action:S.ui.manageFieldAction,open:S.ui.manageCustomFieldsOpen,setOpen:function(e){return T({type:"SET_SHOW_MANAGE_CUSTOM_FIELDS",data:e})},onUpdate:(0,a.Z)((function(){var e;return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return[4,G()];case 1:return e=t.sent(),T({type:"SET_CUSTOM_FIELDS",data:e}),[2]}}))})),category:"customer"}),(0,c.jsxs)(b,{attention:!0,children:["Are you sure you want to delete the contact ",(0,c.jsx)("br",{}),(0,c.jsxs)("span",{className:"font-medium",children:['"',(null===(t=S.data.manageCustomer)||void 0===t?void 0:t.firstName)||""," ",(null===(n=S.data.manageCustomer)||void 0===n?void 0:n.lastName)||"",'"']}),"?"]}),(0,c.jsxs)(j,{confirmText:"Request review",children:[Array.isArray(S.data.manageCustomer.reviewRequested)&&S.data.manageCustomer.reviewRequested.length>0?(0,c.jsxs)("span",{className:"block text-red-500 mb-2",children:["You last requested this contact for a review on"," ",DateTime.fromISO(S.data.manageCustomer.reviewRequested[S.data.manageCustomer.reviewRequested.length-1]).toFormat("DD")]}):"",(0,c.jsx)("span",{className:"border p-2 my-4 block bg-gray-50 w-full",children:S.data.manageCustomer.rating?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("span",{className:"font-medium",children:[S.data.manageCustomer.firstName," left this feedback after paying an invoice:"]}),(0,c.jsx)(K.Z,{className:"block mt-3",rating:customer.rating||0,readOnly:!0})]}):"".concat(S.data.manageCustomer.firstName," has not yet left feedback for your business!")}),"Choose your review platform in",(0,c.jsx)(p(),{href:"/marketing/reviews",children:(0,c.jsx)("a",{className:"link ml-1",children:"settings"})}),"."]})]})}De.auth=!0}},function(e){e.O(0,[6440,7333,696,6235,4544,3443,5292,8622,2891,3056,9435,7286,2734,9231,3994,1671,21,6589,9774,2888,179],(function(){return t=18506,e(e.s=t);var t}));var t=e.O();_N_E=t}]);